import{c as w,a as l,u as M,r as m,j as d,C as N,B as R,i as C,b}from"./index-Cc6PQHHq.js";const v=w({types:{},id:"ticTacToe",initial:"deciding",context:({input:e})=>({board:Array(9).fill(null),mySymbol:e.isInitiator?"X":"O",opponentSymbol:e.isInitiator?"O":"X",isInitiator:e.isInitiator,connections:[]}),states:{deciding:{always:[{target:"playing.myTurn",guard:({context:e})=>e.isInitiator},{target:"playing.opponentTurn"}]},playing:{initial:"decidingTurn",states:{decidingTurn:{always:[{target:"myTurn",guard:({context:e})=>{const a=e.board.filter(Boolean).length%2===0;return a&&e.mySymbol==="X"||!a&&e.mySymbol==="O"}},{target:"opponentTurn"}]},myTurn:{on:{MOVE:{target:"decidingTurn",guard:({context:e,event:t})=>!e.board[t.index],actions:["makeMyMove","broadcastMove"]}}},opponentTurn:{on:{RECEIVE_MOVE:{target:"decidingTurn",actions:"makeOpponentMove"}}}},always:[{target:"won",guard:"checkWinner"},{target:"draw",guard:"checkDraw"}]},won:{on:{RESET:{target:"deciding",actions:["resetBoard","broadcastReset"]},RECEIVE_RESET:{target:"deciding",actions:"resetBoard"}}},draw:{on:{RESET:{target:"deciding",actions:["resetBoard","broadcastReset"]},RECEIVE_RESET:{target:"deciding",actions:"resetBoard"}}}},on:{UPDATE_CONNECTIONS:{actions:"updateConnections"},SYNC_STATE:{target:".playing.decidingTurn",actions:"syncBoard"}}},{actions:{updateConnections:l(({event:e})=>e.type!=="UPDATE_CONNECTIONS"?{}:{connections:e.connections}),makeMyMove:l(({context:e,event:t})=>{if(t.type!=="MOVE")return{};const a=[...e.board];return a[t.index]=e.mySymbol,{board:a}}),makeOpponentMove:l(({context:e,event:t})=>{if(t.type!=="RECEIVE_MOVE")return{};const a=[...e.board];return a[t.index]=e.opponentSymbol,{board:a}}),resetBoard:l({board:()=>Array(9).fill(null)}),syncBoard:l(({event:e})=>e.type!=="SYNC_STATE"?{}:{board:e.board}),broadcastMove:({context:e,event:t})=>{t.type==="MOVE"&&e.connections.forEach(a=>a.send(JSON.stringify({namespace:"game",type:"MOVE",payload:{index:t.index}})))},broadcastReset:({context:e})=>{e.connections.forEach(t=>t.send(JSON.stringify({namespace:"game",type:"RESET"})))}},guards:{checkWinner:({context:e})=>!!u(e.board),checkDraw:({context:e})=>!u(e.board)&&e.board.every(Boolean)}});function u(e){const t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let a=0;a<t.length;a++){const[i,c,o]=t[a];if(e[i]&&e[i]===e[c]&&e[i]===e[o])return e[i]}return null}function B({connections:e,playerNames:t,isInitiator:a,ledger:i,onAddLedger:c}){const[o,p]=M(v,{input:{isInitiator:a}}),{board:g,mySymbol:T}=o.context;m.useEffect(()=>{p({type:"UPDATE_CONNECTIONS",connections:e})},[e,p]),m.useEffect(()=>{const r=n=>{try{const s=JSON.parse(n);if(!C(s))return;s.type==="MOVE_REQUEST"?a&&c?.({type:"MOVE",payload:{index:s.payload.index}}):s.type==="RESET_REQUEST"&&a&&c?.({type:"RESET",payload:{}})}catch{}};return e.forEach(n=>{n.addMessageListener(r)}),()=>{e.forEach(n=>{n.removeMessageListener(r)})}},[e,a,c]),m.useEffect(()=>{if(!i)return;const r=Array(9).fill(null);let n=0;i.forEach(s=>{if(s.action.type==="MOVE"){const O=n%2===0?"X":"O";r[s.action.payload.index]=O,n++}else s.action.type==="RESET"&&(r.fill(null),n=0)}),p({type:"SYNC_STATE",board:r})},[i,p]);const f=r=>{a?c?.({type:"MOVE",payload:{index:r}}):e.forEach(n=>{n.send(JSON.stringify(b("MOVE_REQUEST",{index:r})))})},h=()=>{a?c?.({type:"RESET",payload:{}}):e.forEach(r=>{r.send(JSON.stringify(b("RESET_REQUEST")))})},y=o.matches("playing.myTurn"),S=u(g),x=o.matches("won")?S===T?"You Won!":"Opponent Won!":o.matches("draw")?"Draw!":y?"Your Turn":"Opponent's Turn",E=a||t.length>1;return d.jsxs(N,{className:"p-6 flex flex-col items-center space-y-4 bg-white/50 backdrop-blur-sm border-2 border-primary/20 shadow-xl rounded-2xl",children:[d.jsx("div",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent",children:"Tic-Tac-Toe"}),d.jsx("div",{className:`text-lg font-medium ${y&&E?"text-green-600 animate-pulse":"text-gray-500"}`,children:x}),d.jsx("div",{className:"grid grid-cols-3 gap-3",children:g.map((r,n)=>d.jsx("button",{onClick:()=>f(n),disabled:!y||!!r||o.matches("won")||o.matches("draw")||!E,className:`w-20 h-20 text-3xl font-black rounded-xl transition-all duration-200 border-2 
              ${r==="X"?"text-blue-600 border-blue-200 bg-blue-50":r==="O"?"text-rose-600 border-rose-200 bg-rose-50":"hover:bg-primary/5 hover:border-primary/30 border-gray-100 bg-white"}
              ${!y||r||o.matches("won")||o.matches("draw")||!E?"opacity-50 cursor-not-allowed":""}
              flex items-center justify-center shadow-sm hover:shadow-md active:scale-95`,children:r},n))}),(o.matches("won")||o.matches("draw"))&&E&&d.jsx(R,{onClick:h,variant:"outline",className:"mt-4 hover:bg-primary hover:text-white transition-colors",children:"Play Again"})]})}export{B as default};
