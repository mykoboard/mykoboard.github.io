function Nt(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function Qt(){const n=Nt();if(n.__xstate__)return n.__xstate__}const te=n=>{if(typeof window>"u")return;const t=Qt();t&&t.register(n)};class mt{constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(t){const e={value:t,next:null};if(this._current){this._last.next=e,this._last=e;return}this._current=e,this._last=e,this._active&&this.flush()}flush(){for(;this._current;){const t=this._current;this._process(t.value),this._current=t.next}this._last=null}}const $t=".",ee="",Ot="",ne="#",se="*",Mt="xstate.init",ie="xstate.error",x="xstate.stop";function re(n,t){return{type:`xstate.after.${n}.${t}`}}function tt(n,t){return{type:`xstate.done.state.${n}`,output:t}}function oe(n,t){return{type:`xstate.done.actor.${n}`,output:t,actorId:n}}function Rt(n,t){return{type:`xstate.error.actor.${n}`,error:t,actorId:n}}function jt(n){return{type:Mt,input:n}}function v(n){setTimeout(()=>{throw n})}const ce=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Ct(n,t){const e=vt(n),s=vt(t);return typeof s=="string"?typeof e=="string"?s===e:!1:typeof e=="string"?e in s:Object.keys(e).every(i=>i in s?Ct(e[i],s[i]):!1)}function ot(n){if(Lt(n))return n;const t=[];let e="";for(let s=0;s<n.length;s++){switch(n.charCodeAt(s)){case 92:e+=n[s+1],s++;continue;case 46:t.push(e),e="";continue}e+=n[s]}return t.push(e),t}function vt(n){if(Xe(n))return n.value;if(typeof n!="string")return n;const t=ot(n);return ae(t)}function ae(n){if(n.length===1)return n[0];const t={};let e=t;for(let s=0;s<n.length-1;s++)if(s===n.length-2)e[n[s]]=n[s+1];else{const i=e;e={},i[n[s]]=e}return t}function _t(n,t){const e={},s=Object.keys(n);for(let i=0;i<s.length;i++){const r=s[i];e[r]=t(n[r],r,n,i)}return e}function Dt(n){return Lt(n)?n:[n]}function _(n){return n===void 0?[]:Dt(n)}function et(n,t,e,s){return typeof n=="function"?n({context:t,event:e,self:s}):n}function Lt(n){return Array.isArray(n)}function ue(n){return n.type.startsWith("xstate.error.actor")}function O(n){return Dt(n).map(t=>typeof t>"u"||typeof t=="string"?{target:t}:t)}function Bt(n){if(!(n===void 0||n===ee))return _(n)}function nt(n,t,e){const s=typeof n=="object",i=s?n:void 0;return{next:(s?n.next:n)?.bind(i),error:(s?n.error:t)?.bind(i),complete:(s?n.complete:e)?.bind(i)}}function St(n,t){return`${t}.${n}`}function ct(n,t){const e=t.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!e)return n.implementations.actors[t];const[,s,i]=e,o=n.getStateNodeById(i).config.invoke;return(Array.isArray(o)?o[s]:o).src}function Sn(n){return[...new Set([...n._nodes.flatMap(t=>t.ownEvents)])]}function Pt(n,t){if(t===n||t===se)return!0;if(!t.endsWith(".*"))return!1;const e=t.split("."),s=n.split(".");for(let i=0;i<e.length;i++){const r=e[i],o=s[i];if(r==="*")return i===e.length-1;if(r!==o)return!1}return!0}function bt(n,t){return`${n.sessionId}.${t}`}let fe=0;function de(n,t){const e=new Map,s=new Map,i=new WeakMap,r=new Set,o={},{clock:c,logger:u}=t,d={schedule:(a,h,l,y,g=Math.random().toString(36).slice(2))=>{const A={source:a,target:h,event:l,delay:y,id:g,startedAt:Date.now()},k=bt(a,g);f._snapshot._scheduledEvents[k]=A;const Vt=c.setTimeout(()=>{delete o[k],delete f._snapshot._scheduledEvents[k],f._relay(a,h,l)},y);o[k]=Vt},cancel:(a,h)=>{const l=bt(a,h),y=o[l];delete o[l],delete f._snapshot._scheduledEvents[l],y!==void 0&&c.clearTimeout(y)},cancelAll:a=>{for(const h in f._snapshot._scheduledEvents){const l=f._snapshot._scheduledEvents[h];l.source===a&&d.cancel(a,l.id)}}},p=a=>{if(!r.size)return;const h={...a,rootId:n.sessionId};r.forEach(l=>l.next?.(h))},f={_snapshot:{_scheduledEvents:(t?.snapshot&&t.snapshot.scheduler)??{}},_bookId:()=>`x:${fe++}`,_register:(a,h)=>(e.set(a,h),a),_unregister:a=>{e.delete(a.sessionId);const h=i.get(a);h!==void 0&&(s.delete(h),i.delete(a))},get:a=>s.get(a),getAll:()=>Object.fromEntries(s.entries()),_set:(a,h)=>{const l=s.get(a);if(l&&l!==h)throw new Error(`Actor with system ID '${a}' already exists.`);s.set(a,h),i.set(h,a)},inspect:a=>{const h=nt(a);return r.add(h),{unsubscribe(){r.delete(h)}}},_sendInspectionEvent:p,_relay:(a,h,l)=>{f._sendInspectionEvent({type:"@xstate.event",sourceRef:a,actorRef:h,event:l}),h._send(l)},scheduler:d,getSnapshot:()=>({_scheduledEvents:{...f._snapshot._scheduledEvents}}),start:()=>{const a=f._snapshot._scheduledEvents;f._snapshot._scheduledEvents={};for(const h in a){const{source:l,target:y,event:g,delay:A,id:k}=a[h];d.schedule(l,y,g,A,k)}},_clock:c,_logger:u};return f}let F=!1;const at=1;let m=(function(n){return n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped",n})({});const he={clock:{setTimeout:(n,t)=>setTimeout(n,t),clearTimeout:n=>clearTimeout(n)},logger:console.log.bind(console),devTools:!1};class le{constructor(t,e){this.logic=t,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new mt(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=m.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this.systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const s={...he,...e},{clock:i,logger:r,parent:o,syncSnapshot:c,id:u,systemId:d,inspect:p}=s;this.system=o?o.system:de(this,{clock:i,logger:r}),p&&!o&&this.system.inspect(nt(p)),this.sessionId=this.system._bookId(),this.id=u??this.sessionId,this.logger=e?.logger??this.system._logger,this.clock=e?.clock??this.system._clock,this._parent=o,this._syncSnapshot=c,this.options=s,this.src=s.src??t,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:f=>{this._deferred.push(f)},system:this.system,stopChild:f=>{if(f._parent!==this)throw new Error(`Cannot stop child actor ${f.id} of ${this.id} because it is not a child`);f._stop()},emit:f=>{const a=this.eventListeners.get(f.type),h=this.eventListeners.get("*");if(!a&&!h)return;const l=[...a?a.values():[],...h?h.values():[]];for(const y of l)try{y(f)}catch(g){v(g)}},actionExecutor:f=>{const a=()=>{if(this._actorScope.system._sendInspectionEvent({type:"@xstate.action",actorRef:this,action:{type:f.type,params:f.params}}),!f.exec)return;const h=F;try{F=!0,f.exec(f.info,f.params)}finally{F=h}};this._processingStatus===m.Running?a():this._deferred.push(a)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),d&&(this.systemId=d,this.system._set(d,this)),this._initState(e?.snapshot??e?.state),d&&this._snapshot.status!=="active"&&this.system._unregister(this)}_initState(t){try{this._snapshot=t?this.logic.restoreSnapshot?this.logic.restoreSnapshot(t,this._actorScope):t:this.logic.getInitialSnapshot(this._actorScope,this.options?.input)}catch(e){this._snapshot={status:"error",output:void 0,error:e}}}update(t,e){this._snapshot=t;let s;for(;s=this._deferred.shift();)try{s()}catch(i){this._deferred.length=0,this._snapshot={...t,status:"error",error:i}}switch(this._snapshot.status){case"active":for(const i of this.observers)try{i.next?.(t)}catch(r){v(r)}break;case"done":for(const i of this.observers)try{i.next?.(t)}catch(r){v(r)}this._stopProcedure(),this._complete(),this._doneEvent=oe(this.id,this._snapshot.output),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error);break}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:e,snapshot:t})}subscribe(t,e,s){const i=nt(t,e,s);if(this._processingStatus!==m.Stopped)this.observers.add(i);else switch(this._snapshot.status){case"done":try{i.complete?.()}catch(r){v(r)}break;case"error":{const r=this._snapshot.error;if(!i.error)v(r);else try{i.error(r)}catch(o){v(o)}break}}return{unsubscribe:()=>{this.observers.delete(i)}}}on(t,e){let s=this.eventListeners.get(t);s||(s=new Set,this.eventListeners.set(t,s));const i=e.bind(void 0);return s.add(i),{unsubscribe:()=>{s.delete(i)}}}start(){if(this._processingStatus===m.Running)return this;this._syncSnapshot&&this.subscribe({next:s=>{s.status==="active"&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:s})},error:()=>{}}),this.system._register(this.sessionId,this),this.systemId&&this.system._set(this.systemId,this),this._processingStatus=m.Running;const t=jt(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:t}),this._snapshot.status){case"done":return this.update(this._snapshot,t),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(s){return this._snapshot={...this._snapshot,status:"error",error:s},this._error(s),this}return this.update(this._snapshot,t),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(t){let e,s;try{e=this.logic.transition(this._snapshot,t,this._actorScope)}catch(i){s={err:i}}if(s){const{err:i}=s;this._snapshot={...this._snapshot,status:"error",error:i},this._error(i);return}this.update(e,t),t.type===x&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===m.Stopped?this:(this.mailbox.clear(),this._processingStatus===m.NotStarted?(this._processingStatus=m.Stopped,this):(this.mailbox.enqueue({type:x}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(const t of this.observers)try{t.complete?.()}catch(e){v(e)}this.observers.clear(),this.eventListeners.clear()}_reportError(t){if(!this.observers.size){this._parent||v(t),this.eventListeners.clear();return}let e=!1;for(const s of this.observers){const i=s.error;e||=!i;try{i?.(t)}catch(r){v(r)}}this.observers.clear(),this.eventListeners.clear(),e&&v(t)}_error(t){this._stopProcedure(),this._reportError(t),this._parent&&this.system._relay(this,this._parent,Rt(this.id,t))}_stopProcedure(){return this._processingStatus!==m.Running?this:(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new mt(this._process.bind(this)),this._processingStatus=m.Stopped,this.system._unregister(this),this)}_send(t){this._processingStatus!==m.Stopped&&this.mailbox.enqueue(t)}send(t){this.system._relay(void 0,this,t)}attachDevTools(){const{devTools:t}=this.options;t&&(typeof t=="function"?t:te)(this)}toJSON(){return{xstate$$type:at,id:this.id}}getPersistedSnapshot(t){return this.logic.getPersistedSnapshot(this._snapshot,t)}[ce](){return this}getSnapshot(){return this._snapshot}}function E(n,...[t]){return new le(n,t)}const bn=E;function pe(n,t,e,s,{sendId:i}){const r=typeof i=="function"?i(e,s):i;return[t,{sendId:r},void 0]}function ye(n,t){n.defer(()=>{n.system.scheduler.cancel(n.self,t.sendId)})}function ut(n){function t(e,s){}return t.type="xstate.cancel",t.sendId=n,t.resolve=pe,t.execute=ye,t}function ge(n,t,e,s,{id:i,systemId:r,src:o,input:c,syncSnapshot:u}){const d=typeof o=="string"?ct(t.machine,o):o,p=typeof i=="function"?i(e):i;let f,a;return d&&(a=typeof c=="function"?c({context:t.context,event:e.event,self:n.self}):c,f=E(d,{id:p,src:o,parent:n.self,syncSnapshot:u,systemId:r,input:a})),[T(t,{children:{...t.children,[p]:f}}),{id:i,systemId:r,actorRef:f,src:o,input:a},void 0]}function me(n,{actorRef:t}){t&&n.defer(()=>{t._processingStatus!==m.Stopped&&t.start()})}function ft(...[n,{id:t,systemId:e,input:s,syncSnapshot:i=!1}={}]){function r(o,c){}return r.type="xstate.spawnChild",r.id=t,r.systemId=e,r.src=n,r.input=s,r.syncSnapshot=i,r.resolve=ge,r.execute=me,r}function ve(n,t,e,s,{actorRef:i}){const r=typeof i=="function"?i(e,s):i,o=typeof r=="string"?t.children[r]:r;let c=t.children;return o&&(c={...c},delete c[o.id]),[T(t,{children:c}),o,void 0]}function Jt(n,t){const e=t.getSnapshot();if(e&&"children"in e)for(const s of Object.values(e.children))Jt(n,s);n.system._unregister(t)}function _e(n,t){if(t){if(Jt(n,t),t._processingStatus!==m.Running){n.stopChild(t);return}n.defer(()=>{n.stopChild(t)})}}function P(n){function t(e,s){}return t.type="xstate.stopChild",t.actorRef=n,t.resolve=ve,t.execute=_e,t}const wn=P;function Se(n,t,{stateValue:e}){if(typeof e=="string"&&J(e)){const s=n.machine.getStateNodeById(e);return n._nodes.some(i=>i===s)}return n.matches(e)}function xn(n){function t(){return!1}return t.check=Se,t.stateValue=n,t}function be(n,{context:t,event:e},{guards:s}){return!I(s[0],t,e,n)}function En(n){function t(e,s){return!1}return t.check=be,t.guards=[n],t}function we(n,{context:t,event:e},{guards:s}){return s.every(i=>I(i,t,e,n))}function Tn(n){function t(e,s){return!1}return t.check=we,t.guards=n,t}function xe(n,{context:t,event:e},{guards:s}){return s.some(i=>I(i,t,e,n))}function In(n){function t(e,s){return!1}return t.check=xe,t.guards=n,t}function I(n,t,e,s){const{machine:i}=s,r=typeof n=="function",o=r?n:i.implementations.guards[typeof n=="string"?n:n.type];if(!r&&!o)throw new Error(`Guard '${typeof n=="string"?n:n.type}' is not implemented.'.`);if(typeof o!="function")return I(o,t,e,s);const c={context:t,event:e},u=r||typeof n=="string"?void 0:"params"in n?typeof n.params=="function"?n.params({context:t,event:e}):n.params:void 0;return"check"in o?o.check(s,c,o):o(c,u)}function Y(n){return n.type==="atomic"||n.type==="final"}function R(n){return Object.values(n.states).filter(t=>t.type!=="history")}function D(n,t){const e=[];if(t===n)return e;let s=n.parent;for(;s&&s!==t;)e.push(s),s=s.parent;return e}function q(n){const t=new Set(n),e=qt(t);for(const s of t)if(s.type==="compound"&&(!e.get(s)||!e.get(s).length))wt(s).forEach(i=>t.add(i));else if(s.type==="parallel"){for(const i of R(s))if(i.type!=="history"&&!t.has(i)){const r=wt(i);for(const o of r)t.add(o)}}for(const s of t){let i=s.parent;for(;i;)t.add(i),i=i.parent}return t}function zt(n,t){const e=t.get(n);if(!e)return{};if(n.type==="compound"){const i=e[0];if(i){if(Y(i))return i.key}else return{}}const s={};for(const i of e)s[i.key]=zt(i,t);return s}function qt(n){const t=new Map;for(const e of n)t.has(e)||t.set(e,[]),e.parent&&(t.has(e.parent)||t.set(e.parent,[]),t.get(e.parent).push(e));return t}function Wt(n,t){const e=q(t);return zt(n,qt(e))}function dt(n,t){return t.type==="compound"?R(t).some(e=>e.type==="final"&&n.has(e)):t.type==="parallel"?R(t).every(e=>dt(n,e)):t.type==="final"}const J=n=>n[0]===ne;function Ee(n,t){return n.transitions.get(t)||[...n.transitions.keys()].filter(s=>Pt(t,s)).sort((s,i)=>i.length-s.length).flatMap(s=>n.transitions.get(s))}function Te(n){const t=n.config.after;if(!t)return[];const e=i=>{const r=re(i,n.id),o=r.type;return n.entry.push(pt(r,{id:o,delay:i})),n.exit.push(ut(o)),o};return Object.keys(t).flatMap(i=>{const r=t[i],o=typeof r=="string"?{target:r}:r,c=Number.isNaN(+i)?i:+i,u=e(c);return _(o).map(d=>({...d,event:u,delay:c}))}).map(i=>{const{delay:r}=i;return{...b(n,i.event,i),delay:r}})}function b(n,t,e){const s=Bt(e.target),i=e.reenter??!1,r=ke(n,s),o={...e,actions:_(e.actions),guard:e.guard,target:r,source:n,reenter:i,eventType:t,toJSON:()=>({...o,source:`#${n.id}`,target:r?r.map(c=>`#${c.id}`):void 0})};return o}function Ie(n){const t=new Map;if(n.config.on)for(const e of Object.keys(n.config.on)){if(e===Ot)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const s=n.config.on[e];t.set(e,O(s).map(i=>b(n,e,i)))}if(n.config.onDone){const e=`xstate.done.state.${n.id}`;t.set(e,O(n.config.onDone).map(s=>b(n,e,s)))}for(const e of n.invoke){if(e.onDone){const s=`xstate.done.actor.${e.id}`;t.set(s,O(e.onDone).map(i=>b(n,s,i)))}if(e.onError){const s=`xstate.error.actor.${e.id}`;t.set(s,O(e.onError).map(i=>b(n,s,i)))}if(e.onSnapshot){const s=`xstate.snapshot.${e.id}`;t.set(s,O(e.onSnapshot).map(i=>b(n,s,i)))}}for(const e of n.after){let s=t.get(e.eventType);s||(s=[],t.set(e.eventType,s)),s.push(e)}return t}function Ae(n,t){const e=typeof t=="string"?n.states[t]:t?n.states[t.target]:void 0;if(!e&&t)throw new Error(`Initial state node "${t}" not found on parent state node #${n.id}`);const s={source:n,actions:!t||typeof t=="string"?[]:_(t.actions),eventType:null,reenter:!1,target:e?[e]:[],toJSON:()=>({...s,source:`#${n.id}`,target:e?[`#${e.id}`]:[]})};return s}function ke(n,t){if(t!==void 0)return t.map(e=>{if(typeof e!="string")return e;if(J(e))return n.machine.getStateNodeById(e);const s=e[0]===$t;if(s&&!n.parent)return W(n,e.slice(1));const i=s?n.key+e:e;if(n.parent)try{return W(n.parent,i)}catch(r){throw new Error(`Invalid transition definition for state node '${n.id}':
${r.message}`)}else throw new Error(`Invalid target: "${e}" is not a valid target from the root node. Did you mean ".${e}"?`)})}function Xt(n){const t=Bt(n.config.target);return t?{target:t.map(e=>typeof e=="string"?W(n.parent,e):e)}:n.parent.initial}function w(n){return n.type==="history"}function wt(n){const t=Ut(n);for(const e of t)for(const s of D(e,n))t.add(s);return t}function Ut(n){const t=new Set;function e(s){if(!t.has(s)){if(t.add(s),s.type==="compound")e(s.initial.target[0]);else if(s.type==="parallel")for(const i of R(s))e(i)}}return e(n),t}function j(n,t){if(J(t))return n.machine.getStateNodeById(t);if(!n.states)throw new Error(`Unable to retrieve child state '${t}' from '${n.id}'; no child states exist.`);const e=n.states[t];if(!e)throw new Error(`Child state '${t}' does not exist on '${n.id}'`);return e}function W(n,t){if(typeof t=="string"&&J(t))try{return n.machine.getStateNodeById(t)}catch{}const e=ot(t).slice();let s=n;for(;e.length;){const i=e.shift();if(!i.length)break;s=j(s,i)}return s}function X(n,t){if(typeof t=="string"){const i=n.states[t];if(!i)throw new Error(`State '${t}' does not exist on '${n.id}'`);return[n,i]}const e=Object.keys(t),s=e.map(i=>j(n,i)).filter(Boolean);return[n.machine.root,n].concat(s,e.reduce((i,r)=>{const o=j(n,r);if(!o)return i;const c=X(o,t[r]);return i.concat(c)},[]))}function $e(n,t,e,s){const r=j(n,t).next(e,s);return!r||!r.length?n.next(e,s):r}function Oe(n,t,e,s){const i=Object.keys(t),r=j(n,i[0]),o=ht(r,t[i[0]],e,s);return!o||!o.length?n.next(e,s):o}function Me(n,t,e,s){const i=[];for(const r of Object.keys(t)){const o=t[r];if(!o)continue;const c=j(n,r),u=ht(c,o,e,s);u&&i.push(...u)}return i.length?i:n.next(e,s)}function ht(n,t,e,s){return typeof t=="string"?$e(n,t,e,s):Object.keys(t).length===1?Oe(n,t,e,s):Me(n,t,e,s)}function Re(n){return Object.keys(n.states).map(t=>n.states[t]).filter(t=>t.type==="history")}function S(n,t){let e=n;for(;e.parent&&e.parent!==t;)e=e.parent;return e.parent===t}function je(n,t){const e=new Set(n),s=new Set(t);for(const i of e)if(s.has(i))return!0;for(const i of s)if(e.has(i))return!0;return!1}function Gt(n,t,e){const s=new Set;for(const i of n){let r=!1;const o=new Set;for(const c of s)if(je(st([i],t,e),st([c],t,e)))if(S(i.source,c.source))o.add(c);else{r=!0;break}if(!r){for(const c of o)s.delete(c);s.add(i)}}return Array.from(s)}function Ce(n){const[t,...e]=n;for(const s of D(t,void 0))if(e.every(i=>S(i,s)))return s}function lt(n,t){if(!n.target)return[];const e=new Set;for(const s of n.target)if(w(s))if(t[s.id])for(const i of t[s.id])e.add(i);else for(const i of lt(Xt(s),t))e.add(i);else e.add(s);return[...e]}function Ht(n,t){const e=lt(n,t);if(!e)return;if(!n.reenter&&e.every(i=>i===n.source||S(i,n.source)))return n.source;const s=Ce(e.concat(n.source));if(s)return s;if(!n.reenter)return n.source.machine.root}function st(n,t,e){const s=new Set;for(const i of n)if(i.target?.length){const r=Ht(i,e);i.reenter&&i.source===r&&s.add(r);for(const o of t)S(o,r)&&s.add(o)}return[...s]}function De(n,t){if(n.length!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0}function it(n,t,e,s,i,r){if(!n.length)return t;const o=new Set(t._nodes);let c=t.historyValue;const u=Gt(n,o,c);let d=t;i||([d,c]=Je(d,s,e,u,o,c,r,e.actionExecutor)),d=C(d,s,e,u.flatMap(f=>f.actions),r,void 0),d=Be(d,s,e,u,o,r,c,i);const p=[...o];d.status==="done"&&(d=C(d,s,e,p.sort((f,a)=>a.order-f.order).flatMap(f=>f.exit),r,void 0));try{return c===t.historyValue&&De(t._nodes,o)?d:T(d,{_nodes:p,historyValue:c})}catch(f){throw f}}function Le(n,t,e,s,i){if(s.output===void 0)return;const r=tt(i.id,i.output!==void 0&&i.parent?et(i.output,n.context,t,e.self):void 0);return et(s.output,n.context,r,e.self)}function Be(n,t,e,s,i,r,o,c){let u=n;const d=new Set,p=new Set;Pe(s,o,p,d),c&&p.add(n.machine.root);const f=new Set;for(const a of[...d].sort((h,l)=>h.order-l.order)){i.add(a);const h=[];h.push(...a.entry);for(const l of a.invoke)h.push(ft(l.src,{...l,syncSnapshot:!!l.onSnapshot}));if(p.has(a)){const l=a.initial.actions;h.push(...l)}if(u=C(u,t,e,h,r,a.invoke.map(l=>l.id)),a.type==="final"){const l=a.parent;let y=l?.type==="parallel"?l:l?.parent,g=y||a;for(l?.type==="compound"&&r.push(tt(l.id,a.output!==void 0?et(a.output,u.context,t,e.self):void 0));y?.type==="parallel"&&!f.has(y)&&dt(i,y);)f.add(y),r.push(tt(y.id)),g=y,y=y.parent;if(y)continue;u=T(u,{status:"done",output:Le(u,t,e,u.machine.root,g)})}}return u}function Pe(n,t,e,s){for(const i of n){const r=Ht(i,t);for(const c of i.target||[])!w(c)&&(i.source!==c||i.source!==r||i.reenter)&&(s.add(c),e.add(c)),M(c,t,e,s);const o=lt(i,t);for(const c of o){const u=D(c,r);r?.type==="parallel"&&u.push(r),Yt(s,t,e,u,!i.source.parent&&i.reenter?void 0:r)}}}function M(n,t,e,s){if(w(n))if(t[n.id]){const i=t[n.id];for(const r of i)s.add(r),M(r,t,e,s);for(const r of i)V(r,n.parent,s,t,e)}else{const i=Xt(n);for(const r of i.target)s.add(r),i===n.parent?.initial&&e.add(n.parent),M(r,t,e,s);for(const r of i.target)V(r,n.parent,s,t,e)}else if(n.type==="compound"){const[i]=n.initial.target;w(i)||(s.add(i),e.add(i)),M(i,t,e,s),V(i,n,s,t,e)}else if(n.type==="parallel")for(const i of R(n).filter(r=>!w(r)))[...s].some(r=>S(r,i))||(w(i)||(s.add(i),e.add(i)),M(i,t,e,s))}function Yt(n,t,e,s,i){for(const r of s)if((!i||S(r,i))&&n.add(r),r.type==="parallel")for(const o of R(r).filter(c=>!w(c)))[...n].some(c=>S(c,o))||(n.add(o),M(o,t,e,n))}function V(n,t,e,s,i){Yt(e,s,i,D(n,t))}function Je(n,t,e,s,i,r,o,c){let u=n;const d=st(s,i,r);d.sort((f,a)=>a.order-f.order);let p;for(const f of d)for(const a of Re(f)){let h;a.history==="deep"?h=l=>Y(l)&&S(l,f):h=l=>l.parent===f,p??={...r},p[a.id]=Array.from(i).filter(h)}for(const f of d)u=C(u,t,e,[...f.exit,...f.invoke.map(a=>P(a.id))],o,void 0),i.delete(f);return[u,p||r]}function ze(n,t){return n.implementations.actions[t]}function Kt(n,t,e,s,i,r){const{machine:o}=n;let c=n;for(const u of s){const d=typeof u=="function",p=d?u:ze(o,typeof u=="string"?u:u.type),f={context:c.context,event:t,self:e.self,system:e.system},a=d||typeof u=="string"?void 0:"params"in u?typeof u.params=="function"?u.params({context:c.context,event:t}):u.params:void 0;if(!p||!("resolve"in p)){e.actionExecutor({type:typeof u=="string"?u:typeof u=="object"?u.type:u.name||"(anonymous)",info:f,params:a,exec:p});continue}const h=p,[l,y,g]=h.resolve(e,c,f,a,p,i);c=l,"retryResolve"in h&&r?.push([h,y]),"execute"in h&&e.actionExecutor({type:h.type,info:f,params:y,exec:h.execute.bind(null,e,y)}),g&&(c=Kt(c,t,e,g,i,r))}return c}function C(n,t,e,s,i,r){const o=r?[]:void 0,c=Kt(n,t,e,s,{internalQueue:i,deferredActorIds:r},o);return o?.forEach(([u,d])=>{u.retryResolve(e,c,d)}),c}function N(n,t,e,s){let i=n;const r=[];function o(d,p,f){e.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:e.self,event:p,snapshot:d,_transitions:f}),r.push(d)}if(t.type===x)return i=T(xt(i,t,e),{status:"stopped"}),o(i,t,[]),{snapshot:i,microstates:r};let c=t;if(c.type!==Mt){const d=c,p=ue(d),f=Et(d,i);if(p&&!f.length)return i=T(n,{status:"error",error:d.error}),o(i,d,[]),{snapshot:i,microstates:r};i=it(f,n,e,c,!1,s),o(i,d,f)}let u=!0;for(;i.status==="active";){let d=u?qe(i,c):[];const p=d.length?i:void 0;if(!d.length){if(!s.length)break;c=s.shift(),d=Et(c,i)}i=it(d,i,e,c,!1,s),u=i!==p,o(i,c,d)}return i.status!=="active"&&xt(i,c,e),{snapshot:i,microstates:r}}function xt(n,t,e){return C(n,t,e,Object.values(n.children).map(s=>P(s)),[],void 0)}function Et(n,t){return t.machine.getTransitionData(t,n)}function qe(n,t){const e=new Set,s=n._nodes.filter(Y);for(const i of s)t:for(const r of[i].concat(D(i,void 0)))if(r.always){for(const o of r.always)if(o.guard===void 0||I(o.guard,n.context,t,n)){e.add(o);break t}}return Gt(Array.from(e),new Set(n._nodes),n.historyValue)}function We(n,t){const e=q(X(n,t));return Wt(n,[...e])}function Xe(n){return!!n&&typeof n=="object"&&"machine"in n&&"value"in n}const Ue=function(t){return Ct(t,this.value)},Ge=function(t){return this.tags.has(t)},He=function(t){const e=this.machine.getTransitionData(this,t);return!!e?.length&&e.some(s=>s.target!==void 0||s.actions.length)},Ye=function(){const{_nodes:t,tags:e,machine:s,getMeta:i,toJSON:r,can:o,hasTag:c,matches:u,...d}=this;return{...d,tags:Array.from(e)}},Ke=function(){return this._nodes.reduce((t,e)=>(e.meta!==void 0&&(t[e.id]=e.meta),t),{})};function z(n,t){return{status:n.status,output:n.output,error:n.error,machine:t,context:n.context,_nodes:n._nodes,value:Wt(t.root,n._nodes),tags:new Set(n._nodes.flatMap(e=>e.tags)),children:n.children,historyValue:n.historyValue||{},matches:Ue,hasTag:Ge,can:He,getMeta:Ke,toJSON:Ye}}function T(n,t={}){return z({...n,...t},n.machine)}function Ze(n){if(typeof n!="object"||n===null)return{};const t={};for(const e in n){const s=n[e];Array.isArray(s)&&(t[e]=s.map(i=>({id:i.id})))}return t}function Fe(n,t){const{_nodes:e,tags:s,machine:i,children:r,context:o,can:c,hasTag:u,matches:d,getMeta:p,toJSON:f,...a}=n,h={};for(const y in r){const g=r[y];h[y]={snapshot:g.getPersistedSnapshot(t),src:g.src,systemId:g.systemId,syncSnapshot:g._syncSnapshot}}return{...a,context:Zt(o),children:h,historyValue:Ze(a.historyValue)}}function Zt(n){let t;for(const e in n){const s=n[e];if(s&&typeof s=="object")if("sessionId"in s&&"send"in s&&"ref"in s)t??=Array.isArray(n)?n.slice():{...n},t[e]={xstate$$type:at,id:s.id};else{const i=Zt(s);i!==s&&(t??=Array.isArray(n)?n.slice():{...n},t[e]=i)}}return t??n}function Ve(n,t,e,s,{event:i,id:r,delay:o},{internalQueue:c}){const u=t.machine.implementations.delays;if(typeof i=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${i}" }) instead`);const d=typeof i=="function"?i(e,s):i;let p;if(typeof o=="string"){const f=u&&u[o];p=typeof f=="function"?f(e,s):f}else p=typeof o=="function"?o(e,s):o;return typeof p!="number"&&c.push(d),[t,{event:d,id:r,delay:p},void 0]}function Ne(n,t){const{event:e,delay:s,id:i}=t;if(typeof s=="number"){n.defer(()=>{const r=n.self;n.system.scheduler.schedule(r,r,e,s,i)});return}}function pt(n,t){function e(s,i){}return e.type="xstate.raise",e.event=n,e.id=t?.id,e.delay=t?.delay,e.resolve=Ve,e.execute=Ne,e}function Qe(n,t){return{config:n,transition:(e,s,i)=>({...e,context:n(e.context,s,i)}),getInitialSnapshot:(e,s)=>({status:"active",output:void 0,error:void 0,context:typeof t=="function"?t({input:s}):t}),getPersistedSnapshot:e=>e,restoreSnapshot:e=>e}}const Q=new WeakMap;function An(n){return{config:n,start:(e,s)=>{const{self:i,system:r,emit:o}=s,c={receivers:void 0,dispose:void 0};Q.set(i,c),c.dispose=n({input:e.input,system:r,self:i,sendBack:u=>{i.getSnapshot().status!=="stopped"&&i._parent&&r._relay(i,i._parent,u)},receive:u=>{c.receivers??=new Set,c.receivers.add(u)},emit:o})},transition:(e,s,i)=>{const r=Q.get(i.self);return s.type===x?(e={...e,status:"stopped",error:void 0},Q.delete(i.self),r.receivers?.clear(),r.dispose?.(),e):(r.receivers?.forEach(o=>o(s)),e)},getInitialSnapshot:(e,s)=>({status:"active",output:void 0,error:void 0,input:s}),getPersistedSnapshot:e=>e,restoreSnapshot:e=>e}}const Tt="xstate.observable.next",U="xstate.observable.error",G="xstate.observable.complete";function kn(n){return{config:n,transition:(e,s)=>{if(e.status!=="active")return e;switch(s.type){case Tt:return{...e,context:s.data};case U:return{...e,status:"error",error:s.data,input:void 0,_subscription:void 0};case G:return{...e,status:"done",input:void 0,_subscription:void 0};case x:return e._subscription.unsubscribe(),{...e,status:"stopped",input:void 0,_subscription:void 0};default:return e}},getInitialSnapshot:(e,s)=>({status:"active",output:void 0,error:void 0,context:void 0,input:s,_subscription:void 0}),start:(e,{self:s,system:i,emit:r})=>{e.status!=="done"&&(e._subscription=n({input:e.input,system:i,self:s,emit:r}).subscribe({next:o=>{i._relay(s,s,{type:Tt,data:o})},error:o=>{i._relay(s,s,{type:U,data:o})},complete:()=>{i._relay(s,s,{type:G})}}))},getPersistedSnapshot:({_subscription:e,...s})=>s,restoreSnapshot:e=>({...e,_subscription:void 0})}}function $n(n){return{config:n,transition:(e,s)=>{if(e.status!=="active")return e;switch(s.type){case U:return{...e,status:"error",error:s.data,input:void 0,_subscription:void 0};case G:return{...e,status:"done",input:void 0,_subscription:void 0};case x:return e._subscription.unsubscribe(),{...e,status:"stopped",input:void 0,_subscription:void 0};default:return e}},getInitialSnapshot:(e,s)=>({status:"active",output:void 0,error:void 0,context:void 0,input:s,_subscription:void 0}),start:(e,{self:s,system:i,emit:r})=>{e.status!=="done"&&(e._subscription=n({input:e.input,system:i,self:s,emit:r}).subscribe({next:o=>{s._parent&&i._relay(s,s._parent,o)},error:o=>{i._relay(s,s,{type:U,data:o})},complete:()=>{i._relay(s,s,{type:G})}}))},getPersistedSnapshot:({_subscription:e,...s})=>s,restoreSnapshot:e=>({...e,_subscription:void 0})}}const It="xstate.promise.resolve",At="xstate.promise.reject",L=new WeakMap;function On(n){return{config:n,transition:(e,s,i)=>{if(e.status!=="active")return e;switch(s.type){case It:{const r=s.data;return{...e,status:"done",output:r,input:void 0}}case At:return{...e,status:"error",error:s.data,input:void 0};case x:return L.get(i.self)?.abort(),L.delete(i.self),{...e,status:"stopped",input:void 0};default:return e}},start:(e,{self:s,system:i,emit:r})=>{if(e.status!=="active")return;const o=new AbortController;L.set(s,o),Promise.resolve(n({input:e.input,system:i,self:s,signal:o.signal,emit:r})).then(u=>{s.getSnapshot().status==="active"&&(L.delete(s),i._relay(s,s,{type:It,data:u}))},u=>{s.getSnapshot().status==="active"&&(L.delete(s),i._relay(s,s,{type:At,data:u}))})},getInitialSnapshot:(e,s)=>({status:"active",output:void 0,error:void 0,input:s}),getPersistedSnapshot:e=>e,restoreSnapshot:e=>e}}const tn=Qe(n=>{},void 0);function Mn(){return E(tn)}function en(n,{machine:t,context:e},s,i){const r=(o,c)=>{if(typeof o=="string"){const u=ct(t,o);if(!u)throw new Error(`Actor logic '${o}' not implemented in machine '${t.id}'`);const d=E(u,{id:c?.id,parent:n.self,syncSnapshot:c?.syncSnapshot,input:typeof c?.input=="function"?c.input({context:e,event:s,self:n.self}):c?.input,src:o,systemId:c?.systemId});return i[d.id]=d,d}else return E(o,{id:c?.id,parent:n.self,syncSnapshot:c?.syncSnapshot,input:c?.input,src:o,systemId:c?.systemId})};return(o,c)=>{const u=r(o,c);return i[u.id]=u,n.defer(()=>{u._processingStatus!==m.Stopped&&u.start()}),u}}function nn(n,t,e,s,{assignment:i}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const r={},o={context:t.context,event:e.event,spawn:en(n,t,e.event,r),self:n.self,system:n.system};let c={};if(typeof i=="function")c=i(o,s);else for(const d of Object.keys(i)){const p=i[d];c[d]=typeof p=="function"?p(o,s):p}const u=Object.assign({},t.context,c);return[T(t,{context:u,children:Object.keys(r).length?{...t.children,...r}:t.children}),void 0,void 0]}function yt(n){function t(e,s){}return t.type="xstate.assign",t.assignment=n,t.resolve=nn,t}const kt=new WeakMap;function $(n,t,e){let s=kt.get(n);return s?t in s||(s[t]=e()):(s={[t]:e()},kt.set(n,s)),s[t]}const sn={},B=n=>typeof n=="string"?{type:n}:typeof n=="function"?"resolve"in n?{type:n.type}:{type:n.name}:n;class H{constructor(t,e){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=e._parent,this.key=e._key,this.machine=e._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join($t),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?_t(this.config.states,(s,i)=>new H(s,{_parent:this,_key:i,_machine:this.machine})):sn,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=_(this.config.entry).slice(),this.exit=_(this.config.exit).slice(),this.meta=this.config.meta,this.output=this.type==="final"||!this.parent?this.config.output:void 0,this.tags=_(t.tags).slice()}_initialize(){this.transitions=Ie(this),this.config.always&&(this.always=O(this.config.always).map(t=>b(this,Ot,t))),Object.keys(this.states).forEach(t=>{this.states[t]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(B),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(t=>`#${t.id}`),source:`#${this.id}`,actions:this.initial.actions.map(B),eventType:null})}:void 0,history:this.history,states:_t(this.states,t=>t.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(t=>({...t,actions:t.actions.map(B)})),entry:this.entry.map(B),exit:this.exit.map(B),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return $(this,"invoke",()=>_(this.config.invoke).map((t,e)=>{const{src:s,systemId:i}=t,r=t.id??St(this.id,e),o=typeof s=="string"?s:`xstate.invoke.${St(this.id,e)}`;return{...t,src:o,id:r,systemId:i,toJSON(){const{onDone:c,onError:u,...d}=t;return{...d,type:"xstate.invoke",src:o,id:r}}}}))}get on(){return $(this,"on",()=>[...this.transitions].flatMap(([e,s])=>s.map(i=>[e,i])).reduce((e,[s,i])=>(e[s]=e[s]||[],e[s].push(i),e),{}))}get after(){return $(this,"delayedTransitions",()=>Te(this))}get initial(){return $(this,"initial",()=>Ae(this,this.config.initial))}next(t,e){const s=e.type,i=[];let r;const o=$(this,`candidates-${s}`,()=>Ee(this,s));for(const c of o){const{guard:u}=c,d=t.context;let p=!1;try{p=!u||I(u,d,e,t)}catch(f){const a=typeof u=="string"?u:typeof u=="object"?u.type:void 0;throw new Error(`Unable to evaluate guard ${a?`'${a}' `:""}in transition for event '${s}' in state node '${this.id}':
${f.message}`)}if(p){i.push(...c.actions),r=c;break}}return r?[r]:void 0}get events(){return $(this,"events",()=>{const{states:t}=this,e=new Set(this.ownEvents);if(t)for(const s of Object.keys(t)){const i=t[s];if(i.states)for(const r of i.events)e.add(`${r}`)}return Array.from(e)})}get ownEvents(){const t=Object.keys(Object.fromEntries(this.transitions)),e=new Set(t.filter(s=>this.transitions.get(s).some(i=>!(!i.target&&!i.actions.length&&!i.reenter))));return Array.from(e)}}const rn="#";class gt{constructor(t,e){this.config=t,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=t.id||"(machine)",this.implementations={actors:e?.actors??{},actions:e?.actions??{},delays:e?.delays??{},guards:e?.guards??{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new H(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(t){const{actions:e,guards:s,actors:i,delays:r}=this.implementations;return new gt(this.config,{actions:{...e,...t.actions},guards:{...s,...t.guards},actors:{...i,...t.actors},delays:{...r,...t.delays}})}resolveState(t){const e=We(this.root,t.value),s=q(X(this.root,e));return z({_nodes:[...s],context:t.context||{},children:{},status:dt(s,this.root)?"done":t.status||"active",output:t.output,error:t.error,historyValue:t.historyValue},this)}transition(t,e,s){return N(t,e,s,[]).snapshot}microstep(t,e,s){return N(t,e,s,[]).microstates}getTransitionData(t,e){return ht(this.root,t.value,t,e)||[]}getPreInitialState(t,e,s){const{context:i}=this.config,r=z({context:typeof i!="function"&&i?i:{},_nodes:[this.root],children:{},status:"active"},this);return typeof i=="function"?C(r,e,t,[yt(({spawn:c,event:u,self:d})=>i({spawn:c,input:u.input,self:d}))],s,void 0):r}getInitialSnapshot(t,e){const s=jt(e),i=[],r=this.getPreInitialState(t,s,i),o=it([{target:[...Ut(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],r,t,s,!0,i),{snapshot:c}=N(o,s,t,i);return c}start(t){Object.values(t.children).forEach(e=>{e.getSnapshot().status==="active"&&e.start()})}getStateNodeById(t){const e=ot(t),s=e.slice(1),i=J(e[0])?e[0].slice(rn.length):e[0],r=this.idMap.get(i);if(!r)throw new Error(`Child state node '#${i}' does not exist on machine '${this.id}'`);return W(r,s)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(t,e){return Fe(t,e)}restoreSnapshot(t,e){const s={},i=t.children;Object.keys(i).forEach(f=>{const a=i[f],h=a.snapshot,l=a.src,y=typeof l=="string"?ct(this,l):l;if(!y)return;const g=E(y,{id:f,parent:e.self,syncSnapshot:a.syncSnapshot,snapshot:h,src:l,systemId:a.systemId});s[f]=g});function r(f,a){if(a instanceof H)return a;try{return f.machine.getStateNodeById(a.id)}catch{}}function o(f,a){if(!a||typeof a!="object")return{};const h={};for(const l in a){const y=a[l];for(const g of y){const A=r(f,g);A&&(h[l]??=[],h[l].push(A))}}return h}const c=o(this.root,t.historyValue),u=z({...t,children:s,_nodes:Array.from(q(X(this.root,t.value))),historyValue:c},this),d=new Set;function p(f,a){if(!d.has(f)){d.add(f);for(const h in f){const l=f[h];if(l&&typeof l=="object"){if("xstate$$type"in l&&l.xstate$$type===at){f[h]=a[l.id];continue}p(l,a)}}}}return p(u.context,s),u}}function on(n,t,e,s,{event:i}){const r=typeof i=="function"?i(e,s):i;return[t,{event:r},void 0]}function cn(n,{event:t}){n.defer(()=>n.emit(t))}function Ft(n){function t(e,s){}return t.type="xstate.emit",t.event=n,t.resolve=on,t.execute=cn,t}let rt=(function(n){return n.Parent="#_parent",n.Internal="#_internal",n})({});function an(n,t,e,s,{to:i,event:r,id:o,delay:c},u){const d=t.machine.implementations.delays;if(typeof r=="string")throw new Error(`Only event objects may be used with sendTo; use sendTo({ type: "${r}" }) instead`);const p=typeof r=="function"?r(e,s):r;let f;if(typeof c=="string"){const l=d&&d[c];f=typeof l=="function"?l(e,s):l}else f=typeof c=="function"?c(e,s):c;const a=typeof i=="function"?i(e,s):i;let h;if(typeof a=="string"){if(a===rt.Parent?h=n.self._parent:a===rt.Internal?h=n.self:a.startsWith("#_")?h=t.children[a.slice(2)]:h=u.deferredActorIds?.includes(a)?a:t.children[a],!h)throw new Error(`Unable to send event to actor '${a}' from machine '${t.machine.id}'.`)}else h=a||n.self;return[t,{to:h,targetId:typeof a=="string"?a:void 0,event:p,id:o,delay:f},void 0]}function un(n,t,e){typeof e.to=="string"&&(e.to=t.children[e.to])}function fn(n,t){n.defer(()=>{const{to:e,event:s,delay:i,id:r}=t;if(typeof i=="number"){n.system.scheduler.schedule(n.self,e,s,i,r);return}n.system._relay(n.self,e,s.type===ie?Rt(n.self.id,s.data):s)})}function K(n,t,e){function s(i,r){}return s.type="xstate.sendTo",s.to=n,s.event=t,s.id=e?.id,s.delay=e?.delay,s.resolve=an,s.retryResolve=un,s.execute=fn,s}function dn(n,t){return K(rt.Parent,n,t)}function Rn(n,t){return K(n,({event:e})=>e,t)}function hn(n,t,e,s,{collect:i}){const r=[],o=function(u){r.push(u)};return o.assign=(...c)=>{r.push(yt(...c))},o.cancel=(...c)=>{r.push(ut(...c))},o.raise=(...c)=>{r.push(pt(...c))},o.sendTo=(...c)=>{r.push(K(...c))},o.sendParent=(...c)=>{r.push(dn(...c))},o.spawnChild=(...c)=>{r.push(ft(...c))},o.stopChild=(...c)=>{r.push(P(...c))},o.emit=(...c)=>{r.push(Ft(...c))},i({context:e.context,event:e.event,enqueue:o,check:c=>I(c,t.context,e.event,t),self:n.self,system:n.system},s),[t,void 0,r]}function ln(n){function t(e,s){}return t.type="xstate.enqueueActions",t.collect=n,t.resolve=hn,t}function pn(n,t,e,s,{value:i,label:r}){return[t,{value:typeof i=="function"?i(e,s):i,label:r},void 0]}function yn({logger:n},{value:t,label:e}){e?n(e,t):n(t)}function gn(n=({context:e,event:s})=>({context:e,event:s}),t){function e(s,i){}return e.type="xstate.log",e.value=n,e.label=t,e.resolve=pn,e.execute=yn,e}function jn(n,t){const e=_(t);if(!e.some(i=>Pt(n.type,i))){const i=e.length===1?`type matching "${e[0]}"`:`one of types matching "${e.join('", "')}"`;throw new Error(`Expected event ${JSON.stringify(n)} to have ${i}`)}}function mn(n,t){return new gt(n,t)}function Z(n){const t=E(n);return{self:t,defer:()=>{},id:"",logger:()=>{},sessionId:"",stopChild:()=>{},system:t.system,emit:()=>{},actionExecutor:()=>{}}}function Cn(n,...[t]){const e=Z(n);return n.getInitialSnapshot(e,t)}function Dn(n,t,e){const s=Z(n);return s.self._snapshot=t,n.transition(t,e,s)}function vn({schemas:n,actors:t,actions:e,guards:s,delays:i}){return{assign:yt,sendTo:K,raise:pt,log:gn,cancel:ut,stopChild:P,enqueueActions:ln,emit:Ft,spawnChild:ft,createStateConfig:r=>r,createAction:r=>r,createMachine:r=>mn({...r,schemas:n},{actors:t,actions:e,guards:s,delays:i}),extend:r=>vn({schemas:n,actors:t,actions:{...e,...r.actions},guards:{...s,...r.guards},delays:{...i,...r.delays}})}}class Ln{constructor(){this.timeouts=new Map,this._now=0,this._id=0,this._flushing=!1,this._flushingInvalidated=!1}now(){return this._now}getId(){return this._id++}setTimeout(t,e){this._flushingInvalidated=this._flushing;const s=this.getId();return this.timeouts.set(s,{start:this.now(),timeout:e,fn:t}),s}clearTimeout(t){this._flushingInvalidated=this._flushing,this.timeouts.delete(t)}set(t){if(this._now>t)throw new Error("Unable to travel back in time");this._now=t,this.flushTimeouts()}flushTimeouts(){if(this._flushing){this._flushingInvalidated=!0;return}this._flushing=!0;const t=[...this.timeouts].sort(([e,s],[i,r])=>{const o=s.start+s.timeout;return r.start+r.timeout>o?-1:1});for(const[e,s]of t){if(this._flushingInvalidated){this._flushingInvalidated=!1,this._flushing=!1,this.flushTimeouts();return}this.now()-s.start>=s.timeout&&(this.timeouts.delete(e),s.fn.call(null))}this._flushing=!1}increment(t){this._now+=t,this.flushTimeouts()}}function Bn(n){return new Promise((t,e)=>{n.subscribe({complete:()=>{t(n.getSnapshot().output)},error:e})})}function Pn(n,t,e){const s=[],i=Z(n);return i.actionExecutor=o=>{s.push(o)},[n.transition(t,e,i),s]}function Jn(n,...[t]){const e=[],s=Z(n);return s.actionExecutor=r=>{e.push(r)},[n.getInitialSnapshot(s,t),e]}function zn(n){const t=[],e=n._nodes.filter(Y),s=new Set;for(const i of e)for(const r of[i].concat(D(i,void 0)))if(!s.has(r.id)){s.add(r.id);for(const[,o]of r.transitions)t.push(...o);r.always&&t.push(...r.always)}return t}const _n={timeout:1/0};function qn(n,t,e){const s={..._n,...e};return new Promise((i,r)=>{const{signal:o}=s;if(o?.aborted){r(o.reason);return}let c=!1;const u=s.timeout===1/0?void 0:setTimeout(()=>{d(),r(new Error(`Timeout of ${s.timeout} ms exceeded`))},s.timeout),d=()=>{clearTimeout(u),c=!0,a?.unsubscribe(),f&&o.removeEventListener("abort",f)};function p(h){t(h)&&(d(),i(h))}let f,a;p(n.getSnapshot()),!c&&(o&&(f=()=>{d(),r(o.reason)},o.addEventListener("abort",f)),a=n.subscribe({next:p,error:h=>{d(),r(h)},complete:()=>{d(),r(new Error("Actor terminated without satisfying predicate"))}}),c&&a.unsubscribe())})}export{le as Actor,Ln as SimulatedClock,rt as SpecialTargets,gt as StateMachine,H as StateNode,Sn as __unsafe_getAllOwnEventDescriptors,Tn as and,jn as assertEvent,yt as assign,ut as cancel,E as createActor,Mn as createEmptyActor,mn as createMachine,Ft as emit,ln as enqueueActions,Rn as forwardTo,An as fromCallback,$n as fromEventObservable,kn as fromObservable,On as fromPromise,Qe as fromTransition,Cn as getInitialSnapshot,Dn as getNextSnapshot,zn as getNextTransitions,X as getStateNodes,Jn as initialTransition,bn as interpret,Xe as isMachineSnapshot,gn as log,Ct as matchesState,En as not,In as or,ae as pathToStateValue,pt as raise,dn as sendParent,K as sendTo,vn as setup,ft as spawnChild,xn as stateIn,wn as stop,P as stopChild,nt as toObserver,Bn as toPromise,Pn as transition,qn as waitFor};
