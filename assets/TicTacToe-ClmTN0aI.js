import{c as R,a as p,u as C,r as b,j as d,C as v,B as V,i as B,b as T}from"./index-D5C2iRPW.js";const _=R({types:{},id:"ticTacToe",initial:"deciding",context:({input:e})=>({board:Array(9).fill(null),mySymbol:e.isInitiator?"X":"O",opponentSymbol:e.isInitiator?"O":"X",isInitiator:e.isInitiator,connections:[]}),states:{deciding:{always:[{target:"playing.myTurn",guard:({context:e})=>e.isInitiator},{target:"playing.opponentTurn"}]},playing:{initial:"decidingTurn",states:{decidingTurn:{always:[{target:"myTurn",guard:({context:e})=>{const a=e.board.filter(Boolean).length%2===0;return a&&e.mySymbol==="X"||!a&&e.mySymbol==="O"}},{target:"opponentTurn"}]},myTurn:{on:{MOVE:{target:"decidingTurn",guard:({context:e,event:r})=>!e.board[r.index],actions:["makeMyMove","broadcastMove"]}}},opponentTurn:{on:{RECEIVE_MOVE:{target:"decidingTurn",actions:"makeOpponentMove"}}}},always:[{target:"won",guard:"checkWinner"},{target:"draw",guard:"checkDraw"}]},won:{on:{RESET:{target:"deciding",actions:["resetBoard","broadcastReset"]},RECEIVE_RESET:{target:"deciding",actions:"resetBoard"}}},draw:{on:{RESET:{target:"deciding",actions:["resetBoard","broadcastReset"]},RECEIVE_RESET:{target:"deciding",actions:"resetBoard"}}}},on:{UPDATE_CONNECTIONS:{actions:"updateConnections"},SYNC_STATE:{target:".playing.decidingTurn",actions:"syncBoard"}}},{actions:{updateConnections:p(({event:e})=>e.type!=="UPDATE_CONNECTIONS"?{}:{connections:e.connections}),makeMyMove:p(({context:e,event:r})=>{if(r.type!=="MOVE")return{};const a=[...e.board];return a[r.index]=e.mySymbol,{board:a}}),makeOpponentMove:p(({context:e,event:r})=>{if(r.type!=="RECEIVE_MOVE")return{};const a=[...e.board];return a[r.index]=e.opponentSymbol,{board:a}}),resetBoard:p({board:()=>Array(9).fill(null)}),syncBoard:p(({event:e})=>e.type!=="SYNC_STATE"?{}:{board:e.board}),broadcastMove:({context:e,event:r})=>{r.type==="MOVE"&&e.connections.forEach(a=>a.send(JSON.stringify({namespace:"game",type:"MOVE",payload:{index:r.index}})))},broadcastReset:({context:e})=>{e.connections.forEach(r=>r.send(JSON.stringify({namespace:"game",type:"RESET"})))}},guards:{checkWinner:({context:e})=>!!g(e.board),checkDraw:({context:e})=>!g(e.board)&&e.board.every(Boolean)}});function g(e){const r=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let a=0;a<r.length;a++){const[s,c,l]=r[a];if(e[s]&&e[s]===e[c]&&e[s]===e[l])return e[s]}return null}function j({connections:e,playerNames:r,isInitiator:a,ledger:s,onAddLedger:c,onFinishGame:l}){const[o,E]=C(_,{input:{isInitiator:a}}),{board:f,mySymbol:h}=o.context;b.useEffect(()=>{E({type:"UPDATE_CONNECTIONS",connections:e})},[e,E]),b.useEffect(()=>{const t=n=>{try{const i=JSON.parse(n);if(!B(i))return;i.type==="MOVE_REQUEST"?a&&c?.({type:"MOVE",payload:{index:i.payload.index}}):i.type==="RESET_REQUEST"&&a&&c?.({type:"RESET",payload:{}})}catch{}};return e.forEach(n=>{n.addMessageListener(t)}),()=>{e.forEach(n=>{n.removeMessageListener(t)})}},[e,a,c]),b.useEffect(()=>{if(!s)return;const t=Array(9).fill(null);let n=0;s.forEach(y=>{if(y.action.type==="MOVE"){const N=n%2===0?"X":"O";t[y.action.payload.index]=N,n++}else y.action.type==="RESET"&&(t.fill(null),n=0)}),E({type:"SYNC_STATE",board:t});const i=g(t),M=!i&&t.every(y=>y!==null);(i||M)&&l?.()},[s,E,l]);const S=t=>{a?c?.({type:"MOVE",payload:{index:t}}):e.forEach(n=>{n.send(JSON.stringify(T("MOVE_REQUEST",{index:t})))})},w=()=>{a?c?.({type:"RESET",payload:{}}):e.forEach(t=>{t.send(JSON.stringify(T("RESET_REQUEST")))})},m=o.matches("playing.myTurn"),x=g(f),O=o.matches("won")?x===h?"You Won!":"Opponent Won!":o.matches("draw")?"Draw!":m?"Your Turn":"Opponent's Turn",u=a||r.length>1;return d.jsxs(v,{className:"p-6 flex flex-col items-center space-y-4 bg-white/50 backdrop-blur-sm border-2 border-primary/20 shadow-xl rounded-2xl",children:[d.jsx("div",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent",children:"Tic-Tac-Toe"}),d.jsx("div",{className:`text-lg font-medium ${m&&u?"text-green-600 animate-pulse":"text-gray-500"}`,children:O}),d.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map((t,n)=>d.jsx("button",{onClick:()=>S(n),disabled:!m||!!t||o.matches("won")||o.matches("draw")||!u,className:`w-20 h-20 text-3xl font-black rounded-xl transition-all duration-200 border-2 
              ${t==="X"?"text-blue-600 border-blue-200 bg-blue-50":t==="O"?"text-rose-600 border-rose-200 bg-rose-50":"hover:bg-primary/5 hover:border-primary/30 border-gray-100 bg-white"}
              ${!m||t||o.matches("won")||o.matches("draw")||!u?"opacity-50 cursor-not-allowed":""}
              flex items-center justify-center shadow-sm hover:shadow-md active:scale-95`,children:t},n))}),(o.matches("won")||o.matches("draw"))&&u&&!l&&d.jsx(V,{onClick:w,variant:"outline",className:"mt-4 hover:bg-primary hover:text-white transition-colors",children:"Play Again"})]})}export{j as default};
