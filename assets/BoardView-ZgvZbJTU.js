import{c as te,y as je,z as Q,A as mt,r as $,s as W,x as ot,u as rt,B as vt,i as C,g as Fe,C as ct,v as xe,d as ie,a as h,h as I,f as l,b as s,e as f,j as R,F as q,t as G,l as X,o as g,k as De,p as O,T as bt,m as wt,n as de}from"./index-DA-nP2Wb.js";import{a as lt}from"./GameRegistry-DGojQGp9.js";import{i as oe}from"./_virtual___federation_fn_import-DF_FD4Z-.js";import{v as Me,_ as dt}from"./ReactComponentWrapper.vue_vue_type_script_setup_true_lang-ZMhEXHXr.js";import{S as Le,C as ke,T as Je}from"./sessions-B_Jl0lr-.js";import{d as ue}from"./db-DfQP2Aol.js";import{R as Ue,A as He,k as Ve,O as Ye,V as ze,F as We,M as Qe,N as Xe,T as Ze}from"./index-BUxZxNbI.js";import{_ as qe}from"./Input.vue_vue_type_script_setup_true_lang-BB6mHwkh.js";const xt=te("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);const et=te("clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);const kt=te("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);const St=te("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const Ct=te("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]]);const It=te("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);const Se=te("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),{createActor:Qs,toObserver:Xs}=await oe("xstate");function Et(e,t){return e===t}const tt=()=>{};function At(e,t,n=Et){const r=mt(e)?e:je(e),a=je(t(r.value?.getSnapshot())),m=x=>{n(a.value,x)||(a.value=x)};return Q(r,(x,y,w)=>{if(a.value=t(x?.getSnapshot()),!x)return;const d=x.subscribe({next:P=>{m(t(P))},error:tt,complete:tt});w(()=>d.unsubscribe())},{immediate:!0}),a}const ae=!1,_t=()=>{const e={net:ae,state:ae,info:ae,error:!0,lobby:ae,sig:ae,webrtc:ae};try{const t=localStorage.getItem("debug_config");if(t)return{...e,...JSON.parse(t)}}catch{}return e},Nt=_t(),u={shouldLog:e=>Nt[e],netIn:(e,t)=>{if(!u.shouldLog("net"))return;let n=t;try{n=JSON.parse(t)}catch{}console.log("%c[NET-IN] %cfrom %s:","color: #22c55e; font-weight: bold;","color: #64748b;",e.slice(0,8),n)},netOut:(e,t)=>{if(!u.shouldLog("net"))return;let n=t;try{n=JSON.parse(t)}catch{}console.log("%c[NET-OUT] %cto %s:","color: #3b82f6; font-weight: bold;","color: #64748b;",e.slice(0,8),n)},state:(e,t,n,r="state")=>{if(!u.shouldLog(r))return;console.log("%c[%s-%s] %c%s",`color: ${e==="EVENT"?"#f59e0b":"#10b981"}; font-weight: bold;`,r.toUpperCase(),e,"color: inherit;",t,n||"")},lobby:(e,t,n)=>{u.state(e,t,n,"lobby")},sig:(e,...t)=>{u.shouldLog("sig")&&console.log("%c[SIG] %c%s","color: #ec4899; font-weight: bold;","color: inherit;",e,...t)},webrtc:(e,...t)=>{u.shouldLog("webrtc")&&console.log("%c[WEBRTC] %c%s","color: #06b6d4; font-weight: bold;","color: inherit;",e,...t)},info:(...e)=>{u.shouldLog("info")&&console.log("%c[INFO]","color: #8b5cf6; font-weight: bold;",...e)},error:(...e)=>{u.shouldLog("error")&&console.error("%c[ERROR]","color: #ef4444; font-weight: bold;",...e)}};var L=(e=>(e.new="new",e.started="started",e.readyToAccept="readyToAccept",e.accepted="accepted",e.answered="answered",e.connected="established",e.closed="closed",e))(L||{});class nt{id;peerConnection;localPlayerName;remotePlayerName;remotePublicKey;dataChannel;iceCandidates;status;signal;messageListeners=[];onClose;updateView;constructor(t){this.id=Me(),this.updateView=t,this.peerConnection=new RTCPeerConnection(Pt),this.iceCandidates=[];let n=null;this.peerConnection.onicecandidate=r=>{r.candidate&&(this.iceCandidates.push(r.candidate),(this.status==="started"||this.status==="answered")&&(this.updateSignal(),n&&clearTimeout(n),n=setTimeout(()=>{this.updateView(this),n=null},200)))},this.peerConnection.onconnectionstatechange=r=>{const a=this.peerConnection.connectionState;u.webrtc(this.id+": Connection state changed to "+a),a==="connected"?(this.status="established",this.updateView(this)):(a==="disconnected"||a==="failed"||a==="closed")&&this.close()}}updateSignal(t){this.peerConnection.localDescription&&(this.signal=new ee(this.id,this.peerConnection.localDescription,t||this.localPlayerName,this.iceCandidates))}openDataChannel(){this.dataChannel=this.peerConnection.createDataChannel("gameData"),this.dataChannel.onopen=t=>u.webrtc(this.id+" Data channel state is: "+this.dataChannel.readyState),this.dataChannel.onclose=t=>u.webrtc(this.id+" Data channel state is: "+this.dataChannel.readyState),this.dataChannel.onerror=t=>u.error(this.id+" Error ",t),this.dataChannel.onmessage=t=>{u.netIn(this.id,t.data),this.messageListeners.forEach(n=>n(t.data))}}setDataChannelCallback(){this.peerConnection.ondatachannel=t=>{u.webrtc("Receive Channel Callback",t),this.dataChannel=t.channel,this.dataChannel.onmessage=n=>{u.netIn(this.id,n.data),this.messageListeners.forEach(r=>r(n.data))},this.dataChannel.onopen=n=>{const r=this.dataChannel.readyState;u.webrtc(this.id+": Data channel state is: "+r),r=="open"&&(u.webrtc(this.id+": Sending ping"),this.send("Ping"))},this.dataChannel.onclose=n=>{const r=this.dataChannel.readyState;u.webrtc(this.id+": Data channel state is: "+r)}}}async prepareOfferSignal(t){console.log("[WebRTC] prepareOfferSignal - playerName:",t),this.localPlayerName=t,this.status="new";try{const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.status="started",this.updateSignal(),this.updateView(this)}catch(n){this.onCreateSessionDescriptionError(n)}}async send(t){this.dataChannel&&this.dataChannel.readyState==="open"&&(u.netOut(this.id,t),await this.dataChannel.send(t))}addMessageListener(t){this.messageListeners.push(t)}removeMessageListener(t){this.messageListeners=this.messageListeners.filter(n=>n!==t)}async acceptOffer(t,n){const r=typeof t=="string"?ee.fromString(t):t;console.log("[WebRTC] acceptOffer - acceptingPlayerName:",n),this.remotePlayerName=r.playerName,this.localPlayerName=n,await this.peerConnection.setRemoteDescription(r.session),r.iceCandidates.forEach(a=>{this.peerConnection.addIceCandidate(a)});try{const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a),this.status="answered",this.updateSignal(),this.updateView(this),this.updateView(this)}catch(a){this.onCreateSessionDescriptionError(a)}}onCreateSessionDescriptionError(t){u.error("Failed to create session description: "+t.toString())}async acceptAnswer(t){const n=typeof t=="string"?ee.fromString(t):t;u.webrtc(this.id+": Accepting answer signal from "+n.playerName),console.log("[WebRTC] acceptAnswer - Guest name:",n.playerName);try{await this.peerConnection.setRemoteDescription(n.session),this.remotePlayerName=n.playerName,n.iceCandidates&&(u.webrtc(this.id+`: Adding ${n.iceCandidates.length} ICE candidates from answer`),n.iceCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r).catch(a=>u.error("Error adding ICE candidate:",a))})),this.updateView(this)}catch(r){u.error(this.id+": Failed to set remote description from answer",r)}}close(){this.dataChannel&&this.dataChannel.close(),this.peerConnection.close(),this.status="closed",this.onClose?.(),this.updateView(this)}}class ee{connectionId;session;playerName;iceCandidates;constructor(t,n,r,a){this.session=n,this.connectionId=t,this.playerName=r,this.iceCandidates=a}toString(){return btoa(JSON.stringify(this))}static fromString(t){const n=JSON.parse(atob(t));return new ee(n.connectionId,n.session,n.playerName,n.iceCandidates)}}const Pt={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};class Tt{socket=null;onMessageCallback;gameId;boardId;peerName;publicKey=null;pingInterval=null;constructor(t,n,r,a){this.gameId=t,this.boardId=n||"",this.peerName=r,this.onMessageCallback=a}updateBoardId(t){u.sig(`Updating signaling boardId from ${this.boardId} to ${t}`),this.boardId=t}async connect(t,n,r){let a="wss://pebsg4v5yk.execute-api.eu-central-1.amazonaws.com/production";const m=new URLSearchParams;m.append("x-api-key",t),n&&(m.append("x-pubkey",n),this.publicKey=n),r&&m.append("x-sig",r);const x=`${a}?${m.toString()}`;return new Promise((y,w)=>{u.sig(`Connecting to signaling server: ${x}`),this.socket=new WebSocket(x),this.socket.onopen=()=>{u.sig("WebSocket Connection Open."),this.pingInterval=setInterval(()=>{this.socket?.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({action:"ping"}))},3e4),y()},this.socket.onmessage=d=>{u.sig("Raw message from server:",d.data);try{const P=JSON.parse(d.data);this.onMessageCallback(P)}catch(P){u.error("Failed to parse signaling message",P)}},this.socket.onclose=d=>{u.sig("Disconnected from signaling server",d.code,d.reason),this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),this.socket=null},this.socket.onerror=d=>{u.error("Signaling WebSocket error:",d),w(d)}})}hostRegister(t,n,r,a){return u.sig("Registering as host for board:",t),this.send({type:"hostRegister",boardId:t,gameId:n,peerName:r,publicKey:a})}guestJoin(t,n,r,a){return u.sig("Joining as guest for board:",t),this.send({type:"guestJoin",boardId:t,peerName:n,publicKey:r,encryptionPublicKey:a})}hostOffer(t,n,r,a,m){return u.sig("Sending offer to guest:",t),this.send({type:"hostOffer",target:t,guestPublicKey:n,offer:r,peerName:this.peerName,publicKey:this.publicKey||void 0,encryptionPublicKey:a,iv:m,boardId:this.boardId})}guestAnswer(t,n,r,a){return u.sig("Sending answer to host:",t),this.send({type:"guestAnswer",target:t,publicKey:n,answer:r,peerName:this.peerName,iv:a,boardId:this.boardId})}deleteOffer(){if(!this.socket||this.socket.readyState!==WebSocket.OPEN){u.sig("Cannot delete offer: Signaling socket is not open.");return}u.sig("Deleting offer for game:",this.gameId,"board:",this.boardId),this.send({type:"deleteOffer",gameId:this.gameId,...this.boardId?{boardId:this.boardId}:{}})}send(t){if(!this.socket||this.socket.readyState!==WebSocket.OPEN)return u.error("Signaling socket not open. State:",this.socket?.readyState),!1;const n={action:"sendMessage",...t};return u.sig("Sending payload to AWS:",n),this.socket.send(JSON.stringify(n)),!0}disconnect(t=!1){t&&this.isConnected&&this.deleteOffer(),this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null),this.socket?.close(),this.socket=null}get isConnected(){return!!this.socket&&this.socket.readyState===WebSocket.OPEN}}const{createMachine:Rt,assign:Oe}=await oe("xstate"),Gt=Rt({types:{},id:"lobby",initial:"selection",context:({input:e})=>({playerName:e.playerName,signalingMode:null,playerCount:2}),states:{selection:{on:{SELECT_MODE:{target:"discovery",actions:Oe({signalingMode:({event:e})=>e.mode})}}},discovery:{on:{GOTO_SELECTION:"selection",SET_PLAYER_COUNT:{actions:Oe({playerCount:({event:e})=>e.count})},SELECT_MODE:{actions:Oe({signalingMode:({event:e})=>e.mode})}}}}}),{createMachine:Lt,assign:K}=await oe("xstate"),{createLobbyMessage:we}=await oe("@mykoboard/integration"),Ot=Lt({types:{},id:"board",initial:"idle",context:({input:e})=>({connections:new Map,playerStatuses:new Map,isInitiator:e.isInitiator||!1,isGameStarted:!1,isGameFinished:!1,playerName:e.playerName,ledger:[],pendingGuest:null,externalParticipants:[],maxPlayers:e.maxPlayers||2,boardId:e.boardId||""}),states:{idle:{on:{HOST:{target:"hosting",actions:K({isInitiator:!0,maxPlayers:({event:e})=>e.maxPlayers||2,boardId:({event:e})=>e.boardId})},JOIN:{target:"joining",actions:K({isInitiator:!1,boardId:({event:e})=>e.boardId})}}},hosting:{on:{REQUEST_JOIN:{target:"approving",actions:K({pendingGuest:({event:e})=>({id:e.connectionId,name:e.peerName,answer:e.answer,connection:e.connection})})}},always:[{target:"preparation",guard:"hasConnections"}]},joining:{always:[{target:"preparation",guard:"hasConnections"}]},approving:{on:{ACCEPT_GUEST:{target:"preparation",actions:["acceptGuest","clearPendingGuest"]},REJECT_GUEST:{target:"hosting",actions:["rejectGuest","clearPendingGuest"]}}},preparation:{on:{START_GAME:{target:"playing",actions:["setGameStarted","broadcastStartGame"]},GAME_STARTED:{target:"playing",actions:"setGameStarted"},REQUEST_JOIN:{target:"approving",actions:K({pendingGuest:({event:e})=>({id:e.connectionId,name:e.peerName,answer:e.answer,connection:e.connection})})}}},playing:{on:{FINISH_GAME:{target:"finished",actions:K({isGameFinished:!0})}}},finished:{on:{RESET_GAME:{target:"preparation",actions:["resetGameStarted","broadcastResetGame"]}}}},on:{UPDATE_CONNECTION:{actions:["updateConnection","syncConnection"]},PEER_DISCONNECTED:{actions:["updateConnectionStatus","removeConnection"]},SET_PLAYER_STATUS:{actions:"setPlayerStatus"},REMOVE_PLAYER:{actions:"removePlayer"},SYNC_LEDGER:{actions:"syncLedger"},LOAD_LEDGER:{actions:K({ledger:({event:e})=>e.ledger})},SYNC_PARTICIPANTS:{actions:K({externalParticipants:({event:e})=>e.participants})},GAME_STARTED:{actions:"setGameStarted"},GAME_RESET:{actions:"resetGameStarted"},CLOSE_SESSION:{target:".idle",actions:["resetContext","closeAllConnections"]}}},{actions:{setGameStarted:K({isGameStarted:!0,isGameFinished:!1}),resetGameStarted:K({isGameStarted:!1,isGameFinished:!1,ledger:[]}),setPlayerStatus:K(({context:e,event:t})=>{if(t.type!=="SET_PLAYER_STATUS")return e;const n=new Map(e.playerStatuses);return n.set(t.playerId,t.status),{playerStatuses:n}}),updateConnectionStatus:K(({context:e,event:t})=>{if(t.type!=="PEER_DISCONNECTED")return e;const n=new Map(e.connections),r=n.get(t.connectionId);return r&&(r.status=L.closed),{connections:n}}),updateConnection:K(({context:e,event:t})=>{if(t.type!=="UPDATE_CONNECTION")return e;const n=t.connection;if(n.status===L.closed&&!e.connections.has(n.id))return e;const r=e.connections.get(n.id);if(r){const x=r._lastKnownStatus!==n.status,y=r._lastKnownSignal!==(n.signal?.toString()||"");if(!x&&!y)return e}n._lastKnownStatus=n.status,n._lastKnownSignal=n.signal?.toString()||"";const a=new Map(e.connections);a.set(n.id,n);const m=new Map(e.playerStatuses);return m.has(n.id)||m.set(n.id,"lobby"),{connections:a,playerStatuses:m}}),syncConnection:({context:e,event:t})=>{if(t.type!=="UPDATE_CONNECTION")return;const n=t.connection;if(e.isInitiator&&n.status===L.connected){if(n._synced)return;n._synced=!0,u.lobby("STATE",`Syncing new connection: ${n.id}`),n.send(JSON.stringify(we("SYNC_LEDGER",e.ledger))),e.isGameStarted&&n.send(JSON.stringify(we("GAME_STARTED")))}},removeConnection:K(({context:e,event:t})=>{if(t.type!=="PEER_DISCONNECTED")return e;const n=new Map(e.connections);return n.delete(t.connectionId),{connections:n}}),removePlayer:K(({context:e,event:t})=>{if(t.type!=="REMOVE_PLAYER")return e;const n=new Map(e.connections),r=n.get(t.playerId);r&&(r.close(),n.delete(t.playerId));const a=new Map(e.playerStatuses);return a.delete(t.playerId),{connections:n,playerStatuses:a}}),syncLedger:K(({context:e,event:t})=>t.type!=="SYNC_LEDGER"?e:{ledger:t.ledger}),broadcastStartGame:({context:e})=>{e.isInitiator&&e.connections.forEach(t=>{t.status===L.connected&&t.send(JSON.stringify(we("START_GAME")))})},broadcastResetGame:({context:e})=>{e.isInitiator&&e.connections.forEach(t=>{t.status===L.connected&&t.send(JSON.stringify(we("GAME_RESET")))})},closeAllConnections:({context:e})=>{e.connections.forEach(t=>t.close())},acceptGuest:({context:e})=>{e.pendingGuest&&(u.sig("Accepting guest:",e.pendingGuest.name),e.pendingGuest.connection.acceptAnswer(e.pendingGuest.answer))},rejectGuest:({context:e})=>{e.pendingGuest&&(u.sig("Rejecting guest:",e.pendingGuest.name),e.pendingGuest.connection.close())},resetContext:K(({context:e})=>({connections:new Map,playerStatuses:new Map,ledger:[],isGameStarted:!1,isGameFinished:!1,isInitiator:!1,maxPlayers:e.maxPlayers,pendingGuest:null,externalParticipants:[],boardId:""})),clearPendingGuest:K({pendingGuest:null})},guards:{hasConnections:({context:e})=>Array.from(e.connections.values()).some(t=>t.status===L.connected)}}),{createActor:ut}=await oe("xstate"),H=$(null),pt=$(!0),st=$([]);ut(Gt,{input:{playerName:"Anonymous"}}).start();const Ke=new Map;function $e(e,t,n=!1,r=2){if(!Ke.has(e)){u.lobby("STATE",`Creating new board actor for ${e}`);const a=ut(Ot,{input:{playerName:t,boardId:e,isInitiator:n,maxPlayers:r}});a.start(),Ke.set(e,a)}return Ke.get(e)}const Kt=async()=>{if(H.value)return;const e=W.getInstance();H.value=await e.getIdentity(),pt.value=!1};Kt();const{Ledger:$t,createLobbyMessage:le,isLobbyMessage:at}=await oe("@mykoboard/integration");function Dt(){const e=ot(),t=rt(),n=$(null),r=$(!1),a=$(""),m=$(!1),x=$([]),y=$(new Map),w=C(()=>e.params.gameId),d=C(()=>e.params.boardId),P=C(()=>lt(w.value||"")),j=C(()=>!!d.value),A=C(()=>!d.value||d.value==="manual"?null:$e(d.value,H.value?.name||"Anonymous",!1)),E=At(A,o=>o),b=C(()=>E.value?.context?.isInitiator||!1),p=C(()=>E.value?.context?.isGameStarted||!1),k=C(()=>E.value?.context?.connections||new Map),z=C(()=>Array.from(k.value.values())),Y=C(()=>z.value.filter(o=>o.status===L.connected)),Ce=C(()=>z.value.filter(o=>o.status!==L.connected&&o.status!==L.closed)),Ie=C(()=>j.value?"game":"lobby"),ne=C(()=>{if(!E.value)return[];const o=E.value.context,c=st.value.find(i=>i.boardId===d.value),v=c?.participants||[],_=o.externalParticipants||[],N=v.find(i=>i.id===H.value?.id||i.publicKey===H.value?.publicKey||i.isYou),U={id:H.value?.id||"local",name:o.playerName||H.value?.name||"Anonymous",status:p.value?"game":"lobby",isConnected:!0,isLocal:!0,isHost:N?N.isHost:b.value,publicKey:H.value?.publicKey},S=[],M=new Set;if(b.value)S.push(U),M.add(U.id);else if(_.length>0){const i=_.find(T=>T.isHost);if(i){const T=Y.value.find(D=>D.status===L.connected);S.push({id:i.id,name:i.name,status:(T?o.playerStatuses.get(T.id):null)||(p.value?"game":"lobby"),isConnected:!!T,isLocal:!1,isHost:!0,publicKey:T?.remotePublicKey||i.publicKey}),M.add(i.id)}S.push(U),M.add(U.id)}return b.value?z.value.forEach(i=>{if(!M.has(i.id)){const T=v.find(F=>F.id===i.id),D=i.remotePublicKey||T?.publicKey;S.push({id:i.id,name:i.remotePlayerName||T?.name||"Anonymous",status:o.playerStatuses.get(i.id)||"lobby",isConnected:i.status===L.connected,isLocal:!1,isHost:!1,publicKey:D}),M.add(i.id)}}):_.length>0&&_.forEach(i=>{i.isHost||M.has(i.id)||i.id===U.id||i.id===H.value?.id||i.publicKey===H.value?.publicKey||(S.push({id:i.id,name:i.name,status:p.value?"game":"lobby",isConnected:!0,isLocal:!1,isHost:!1,publicKey:i.publicKey}),M.add(i.id))}),v.forEach(i=>{!i.isYou&&!M.has(i.id)&&S.push({id:i.id,name:i.name,status:c?.status==="finished"||p.value?"game":"lobby",isConnected:!1,isLocal:!1,isHost:i.isHost,publicKey:i.publicKey})}),S});vt(()=>{const o=E.value;(o?.status==="approving"||o?.status==="hosting"||o?.status==="preparation"||o?.status==="playing"||o?.status==="finished")&&d.value&&d.value!=="manual"&&Le.saveSession({gameId:w.value,boardId:d.value,playerName:o.context.playerName,gameName:P.value?.name||"Unknown Game",lastPlayed:Date.now(),status:o.matches("finished")?"finished":"active",ledger:o.context.ledger,participants:ne.value.map(c=>({id:c.id,name:c.name,isYou:c.isLocal,isHost:c.isHost,publicKey:c.publicKey}))})});const pe=new Map,ge=new Map,Ee=o=>{const c=A.value;if(!c)return;const v=pe.get(o.id),_=o.signal?.toString()||"",N=ge.get(o.id);v===o.status&&N===_||(pe.set(o.id,o.status),ge.set(o.id,_),c.send({type:"UPDATE_CONNECTION",connection:o}),o._hasListener||(o.addMessageListener(U=>{try{const S=JSON.parse(U);if(!at(S))return;if(S.type==="START_GAME"&&c.send({type:"START_GAME"}),S.type==="GAME_STARTED"&&c.send({type:"GAME_STARTED"}),S.type==="GAME_RESET"&&c.send({type:"GAME_RESET"}),S.type==="NEW_BOARD"&&t.replace(`/games/${w.value}/${S.payload}`),S.type==="SYNC_PLAYER_STATUS"&&c.send({type:"SET_PLAYER_STATUS",playerId:o.id,status:S.payload}),S.type==="SYNC_PARTICIPANTS"&&c.send({type:"SYNC_PARTICIPANTS",participants:S.payload}),S.type==="SYNC_LEDGER"){const M=S.payload;for(const i of M)i.signature&&i.signerPublicKey&&W.verify(i.action,i.signature,i.signerPublicKey).then(T=>{T||u.error("Invalid signature in ledger entry",i)});c.send({type:"SYNC_LEDGER",ledger:S.payload})}}catch{}}),o._hasListener=!0))},he=async(o,c)=>{const v=c||o;if(u.sig("setupSignaling called with gameId:",o,"boardId:",c,"resolved currentBoardId:",v),!!v&&(a.value!==v&&n.value?.isConnected&&(u.sig("Switching signaling board assignment from",a.value,"to",v),n.value.updateBoardId(v),a.value=v),(!n.value||!n.value.isConnected)&&!r.value)){r.value=!0;try{const _=W.getInstance(),N=await _.getIdentity();if(N){const U=new Tt(o||"default",v,N.name,async i=>{if(i.type==="error"){if(u.error("Signaling error:",i.message||i.code),(i.code==="SESSION_NOT_FOUND"||i.code==="HOST_UNREACHABLE")&&!b.value){if(p.value){u.sig(`${i.code} received after game started, ignoring.`);return}u.sig(`${i.code}, retrying in 3s...`),setTimeout(()=>{m.value=!1},3e3);return}xe.error(i.message||"Signaling error occurred"),i.code==="DUPLICATE_IDENTITY"&&t.replace(`/games/${o}`)}if(i.type==="peerJoined"&&(u.sig("Peer joined:",i.peerName,"publicKey:",i.publicKey),await Ne(i.publicKey)?(u.sig("Auto-approving known identity:",i.peerName),await ye({connectionId:i.from,peerName:i.peerName||"Guest",publicKey:i.publicKey,encryptionPublicKey:i.encryptionPublicKey,timestamp:Date.now()})):x.value.push({connectionId:i.from,peerName:i.peerName||"Guest",publicKey:i.publicKey,encryptionPublicKey:i.encryptionPublicKey,timestamp:Date.now()})),i.type==="offer"){u.sig("Received offer from host:",i.from);const T=i.boardId||a.value;if(!T){u.error("No valid target board UUID for offer message");return}const D=$e(T,N.name,!1),F=new nt(Z=>{D.send({type:"UPDATE_CONNECTION",connection:Z})});F.addMessageListener(Z=>{try{const B=JSON.parse(Z);if(!at(B))return;if(B.type==="START_GAME"&&D.send({type:"START_GAME"}),B.type==="GAME_STARTED"&&D.send({type:"GAME_STARTED"}),B.type==="GAME_RESET"&&D.send({type:"GAME_RESET"}),B.type==="NEW_BOARD"&&t.replace(`/games/${o}/${B.payload}`),B.type==="SYNC_PLAYER_STATUS"&&D.send({type:"SET_PLAYER_STATUS",playerId:F.id,status:B.payload}),B.type==="SYNC_PARTICIPANTS"&&D.send({type:"SYNC_PARTICIPANTS",participants:B.payload}),B.type==="SYNC_LEDGER"){const Be=B.payload;for(const se of Be)se.signature&&se.signerPublicKey&&W.verify(se.action,se.signature,se.signerPublicKey).then(ft=>{ft||u.error("Invalid signature in ledger entry",se)});D.send({type:"SYNC_LEDGER",ledger:Be})}}catch(B){u.error("Failed to parse message:",B)}}),F.onClose=()=>{D.send({type:"PEER_DISCONNECTED",connectionId:F.id})},F.setDataChannelCallback(),i.publicKey&&(F.remotePublicKey=i.publicKey),i.peerName&&(F.remotePlayerName=i.peerName),F.acceptOffer(i.offer,N.name).then(()=>{const Z=setInterval(()=>{F.signal&&n.value&&(clearInterval(Z),n.value.guestAnswer(i.from,N.publicKey,F.signal))},100)}).catch(Z=>{u.error("Failed to accept offer:",Z)})}if(i.type==="answer"){u.sig("Received answer from guest:",i.from);const T=y.value.get(i.from);if(T&&i.answer){i.publicKey&&(T.remotePublicKey=i.publicKey),i.peerName&&(T.remotePlayerName=i.peerName);let D=i.answer;!(i.answer instanceof ee)&&typeof i.answer=="object"&&(D=new ee(i.answer.connectionId,i.answer.session,i.answer.playerName,i.answer.iceCandidates||[]));try{T.acceptAnswer(D),y.value.delete(i.from)}catch(F){u.error("Failed to accept answer:",F)}}}}),S=`SIGN_IN:${N.subscriptionToken}`,M=await _.sign(S);await U.connect(N.subscriptionToken,N.publicKey,M),n.value=U,a.value=v}}catch(_){u.error("Failed to connect to signaling server:",_)}finally{r.value=!1}}},Ae=async(o=2)=>{if(!j.value){const c=Me();t.push(`/games/${w.value}/${c}?maxPlayers=${o}`)}},_e=async()=>{if(!d.value||!n.value?.isConnected){u.error("Cannot join as guest: missing boardId or signaling not connected");return}const c=await W.getInstance().getIdentity();c&&(u.sig("Sending guestJoin for boardId:",d.value),n.value.guestJoin(d.value,c.name,c.publicKey,c.publicKey))},Ne=async o=>(await ue.getAllKnownIdentities()).some(v=>v.publicKey===o),ye=async o=>{u.sig("Approving peer:",o.peerName,"publicKey:",o.publicKey);const c=new nt(_=>{A.value?.send({type:"UPDATE_CONNECTION",connection:_})});c.onClose=()=>{A.value?.send({type:"PEER_DISCONNECTED",connectionId:c.id}),y.value.delete(o.connectionId)},c.remotePublicKey=o.publicKey,c.openDataChannel(),await c.prepareOfferSignal(E.value?.context?.playerName||H.value?.name||"Anonymous"),y.value.set(o.connectionId,c);const v=setInterval(()=>{c.signal&&n.value&&(clearInterval(v),W.getInstance().getIdentity().then(N=>{N&&n.value&&n.value.hostOffer(o.connectionId,o.publicKey,c.signal,N.publicKey)}))},100)},Pe=async o=>{x.value=x.value.filter(c=>c.connectionId!==o.connectionId),await ye(o)},Te=o=>{x.value=x.value.filter(c=>c.connectionId!==o.connectionId)},fe=async o=>{try{const c={id:`identity-${Date.now()}`,name:o.peerName,publicKey:o.publicKey,addedAt:Date.now()};await ue.addKnownIdentity(c),xe.success("Identity Saved")}catch{xe.error("Failed to save identity")}},Re=()=>{n.value&&b.value&&n.value.deleteOffer(),A.value?.send({type:"START_GAME"})},me=()=>{A.value?.send({type:"FINISH_GAME"}),d.value&&Le.updateStatus(d.value,"finished")},Ge=async o=>{if(!b.value||!A.value)return;const c=W.getInstance(),v=await c.getIdentity();if(!v)return;const _=await c.sign(o),N=$t.fromEntries(E.value?.context?.ledger||[]),U=await N.addEntry({...o});U.signature=_,U.signerPublicKey=v.publicKey;const S=N.getEntries();A.value.send({type:"SYNC_LEDGER",ledger:S}),Y.value.forEach(M=>{M.send(JSON.stringify(le("SYNC_LEDGER",S)))})},ve=()=>{const o=Me();Y.value.forEach(c=>{c.status===L.connected&&c.send(JSON.stringify(le("NEW_BOARD",o)))}),n.value?.deleteOffer(),A.value?.send({type:"CLOSE_SESSION"}),t.push(`/games/${w.value}/${o}`)},J=()=>{const o=E.value?.context?.pendingGuest;A.value?.send({type:"ACCEPT_GUEST"}),o&&Ee(o.connection)},V=()=>A.value?.send({type:"REJECT_GUEST"}),re=o=>{o.close(),A.value?.send({type:"PEER_DISCONNECTED",connectionId:o.id})},gt=()=>{n.value?.deleteOffer(),A.value?.send({type:"CLOSE_SESSION"}),t.push(`/games/${w.value}`)},ht=()=>{t.push(`/games/${w.value}`)},ce=$(null),yt=async()=>{if("wakeLock"in navigator)try{ce.value=await navigator.wakeLock.request("screen"),u.sig("Wake Lock acquired successfully"),ce.value.addEventListener("release",()=>{u.sig("Wake Lock released")})}catch(o){u.error(`Wake Lock failed: ${o.name}, ${o.message}`)}},be=async()=>{if(document.visibilityState==="visible"){u.sig("App became visible, checking signaling status...");const o=Y.value.length>0;n.value&&!n.value.isConnected?(!p.value||!o)&&(m.value=!1,await he(w.value,d.value)):n.value?.isConnected&&(!p.value||!o)&&(m.value=!1)}};return Fe(()=>{document.addEventListener("visibilitychange",be),window.addEventListener("focus",be),j.value&&yt()}),ct(()=>{document.removeEventListener("visibilitychange",be),window.removeEventListener("focus",be),ce.value&&(ce.value.release(),ce.value=null)}),Q([b,ne],()=>{if(!b.value)return;const o=ne.value.map(c=>({id:c.id,name:c.name,isHost:c.isHost,publicKey:c.publicKey}));Y.value.forEach(c=>{if(c.status===L.connected)try{c.send(JSON.stringify(le("SYNC_PARTICIPANTS",o)))}catch(v){u.error("Failed to sync participants",v)}})},{deep:!0,immediate:!0}),Q([d,j],async()=>{j.value&&d.value&&await he(w.value,d.value)},{immediate:!0}),Q([n,E,d],async()=>{if(!n.value?.isConnected||!d.value||m.value)return;const c=await W.getInstance().getIdentity();if(!c)return;const v=E.value;if(!v)return;const _=v.matches("hosting")||v.matches("preparation"),N=v.matches("joining");_&&v.context.isInitiator?(n.value.hostRegister(d.value,w.value,c.name,c.publicKey),m.value=!0):(N||!v.context.isInitiator)&&(n.value.guestJoin(d.value,c.name,c.publicKey,c.publicKey),m.value=!0)}),Q(d,async o=>{if(o&&o!=="manual"&&j.value){const c=await Le.getSession(o),v=$e(o,H.value?.name||"Anonymous",!1),_=v.getSnapshot().context;c&&c.ledger.length>0&&_.ledger.length===0&&(v.send({type:"LOAD_LEDGER",ledger:c.ledger}),v.send({type:"GAME_STARTED"}),c.status==="finished"&&setTimeout(()=>v.send({type:"FINISH_GAME"}),10))}},{immediate:!0}),Q(Y,o=>{o.forEach(c=>{c._hasInitialSync||(c.send(JSON.stringify(le("SYNC_PLAYER_STATUS",Ie.value))),b.value&&d.value&&d.value!=="manual"&&c.send(JSON.stringify(le("NEW_BOARD",d.value))),c._hasInitialSync=!0)})}),{identity:H,isLoading:pt,snapshot:E,send:o=>A.value?.send(o),signalingClient:n,isServerConnecting:r,pendingJoinRequests:x,activeSessions:st,playerInfos:ne,connectedPeers:Y,pendingSignaling:Ce,isInitiator:b,isGameStarted:p,onHostAGame:Ae,onJoinAsGuest:_e,onApprovePeer:Pe,onRejectPeer:Te,saveIdentityOnApprove:fe,startGame:Re,onFinishGame:me,onAddLedger:Ge,handlePlayAgain:ve,onAcceptGuest:J,onRejectGuest:V,onCancelSignaling:re,onBackToGames:gt,onBackToDiscovery:ht}}const Mt={class:"space-y-4 animate-fade-in-up"},Ft={key:0,class:"glass-dark p-6 rounded-2xl border border-white/5 shadow-glass-dark flex items-center justify-center space-x-4"},Bt={key:1,class:"glass-dark p-6 rounded-2xl border border-white/5 shadow-glass-dark"},jt={class:"text-sm font-black text-white uppercase tracking-[0.2em] mb-4 flex items-center gap-3"},Jt={key:2,class:"glass-dark p-6 rounded-2xl border border-white/5 shadow-glass-dark group hover:border-primary/20 transition-all duration-500"},Ut={class:"text-[10px] font-black uppercase tracking-[0.2em] mb-4 flex items-center gap-2 text-primary"},Ht={class:"space-y-4"},Vt={class:"p-4 bg-white/5 rounded-xl border border-white/10 relative group min-h-[64px] flex items-center group-hover:neon-border transition-all duration-500"},Yt={class:"text-[10px] font-mono break-all line-clamp-2 text-white/40 pr-8"},zt={key:1,class:"text-[10px] text-white/20 italic tracking-wider"},Wt={key:3,class:"glass-dark p-6 rounded-2xl border border-white/5 shadow-glass-dark group hover:border-primary/20 transition-all duration-500"},Qt={class:"text-[10px] font-black uppercase tracking-[0.2em] mb-4 flex items-center gap-2 text-primary"},Xt={class:"space-y-3"},Zt={class:"p-4 bg-white/5 rounded-xl border border-white/10 relative group min-h-[64px] flex items-center group-hover:neon-border transition-all duration-500"},qt={class:"text-[10px] font-mono break-all line-clamp-2 text-white/40 pr-8"},en={key:1,class:"text-[10px] text-white/20 italic tracking-wider"},tn={key:4,class:"flex justify-end"},it=ie({__name:"SignalingStep",props:{connection:{},onOfferChange:{type:Function},onAnswerChange:{type:Function},onCancel:{type:Function}},setup(e){const t=$(!1),n=r=>{r&&(navigator.clipboard.writeText(r),t.value=!0,setTimeout(()=>t.value=!1,2e3))};return(r,a)=>(g(),h("div",Mt,[e.connection.status===l(L).new?(g(),h("div",Ft,[...a[5]||(a[5]=[s("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary"},null,-1),s("p",{class:"text-sm text-white/50 font-bold uppercase tracking-widest"},"Generating invite signal...",-1)])])):I("",!0),e.connection.status===l(L).readyToAccept?(g(),h("div",Bt,[s("h3",jt,[f(l(Ct),{class:"w-5 h-5 text-primary"}),a[6]||(a[6]=R(" Paste Join Offer ",-1))]),a[7]||(a[7]=s("p",{class:"text-[10px] text-white/30 uppercase tracking-widest mb-4"},"External node signal required for connection.",-1)),f(qe,{placeholder:"Paste offer string here...",className:"h-12 bg-white/5 border-white/10 rounded-xl focus:ring-primary text-white font-mono text-xs placeholder:text-white/20","onUpdate:modelValue":a[0]||(a[0]=m=>e.onOfferChange(e.connection,m))})])):I("",!0),e.connection.status===l(L).started?(g(),h("div",Jt,[s("h3",Ut,[f(l(Se),{class:"w-4 h-4"}),a[8]||(a[8]=R(" Active Invite Vector ",-1))]),s("div",Ht,[s("div",Vt,[e.connection.signal?(g(),h(q,{key:0},[s("div",Yt,G(e.connection.signal.toString()),1),s("button",{class:"absolute top-2 right-2 h-8 w-8 flex items-center justify-center text-primary hover:bg-primary/10 transition-colors rounded-lg",onClick:a[1]||(a[1]=m=>n(e.connection.signal.toString()))},[t.value?(g(),X(l(ke),{key:0,class:"w-4 h-4"})):(g(),X(l(et),{key:1,class:"w-4 h-4"}))])],64)):(g(),h("div",zt,"Gathering node connection details..."))]),a[9]||(a[9]=s("p",{class:"text-[10px] text-white/30 uppercase font-medium leading-relaxed tracking-wider"}," Transmit this vector to a peer node. Their response will be synthesized automatically. ",-1)),f(qe,{placeholder:"Awaiting peer response vector...",className:"h-10 bg-white/5 border-white/10 rounded-xl focus:ring-primary text-white font-mono text-[10px] placeholder:text-white/20","onUpdate:modelValue":a[2]||(a[2]=m=>e.onAnswerChange(e.connection,m))})])])):I("",!0),e.connection.status===l(L).answered?(g(),h("div",Wt,[s("h3",Qt,[f(l(ke),{class:"w-4 h-4"}),a[10]||(a[10]=R(" Signal Response Synthesized ",-1))]),s("div",Xt,[s("div",Zt,[e.connection.signal?(g(),h(q,{key:0},[s("div",qt,G(e.connection.signal.toString()),1),s("button",{class:"absolute top-2 right-2 h-8 w-8 flex items-center justify-center text-primary hover:bg-primary/10 transition-colors rounded-lg",onClick:a[3]||(a[3]=m=>n(e.connection.signal.toString()))},[t.value?(g(),X(l(ke),{key:0,class:"w-4 h-4"})):(g(),X(l(et),{key:1,class:"w-4 h-4"}))])],64)):(g(),h("div",en,"Finalizing response..."))]),a[11]||(a[11]=s("p",{class:"text-[10px] text-primary font-black uppercase tracking-widest"},"Transmit this payload back to peer to complete handshake.",-1))])])):I("",!0),e.onCancel?(g(),h("div",tn,[s("button",{onClick:a[4]||(a[4]=m=>e.onCancel(e.connection)),class:"text-[10px] font-black uppercase tracking-widest text-white/20 hover:text-rose-500 transition-colors p-2"}," De-initialize Link ")])):I("",!0)]))}}),nn={class:"space-y-8"},sn={key:0,class:"fixed inset-0 z-[100] flex items-center justify-center bg-[#0A0A0A]/80 backdrop-blur-xl animate-fade-in p-6"},an={class:"glass-dark p-10 w-full max-w-md shadow-2xl border border-white/10 rounded-[2.5rem] space-y-8 animate-zoom-in"},on={class:"flex flex-col items-center text-center space-y-6"},rn={class:"h-20 w-20 bg-primary/10 rounded-[1.5rem] flex items-center justify-center border border-primary/20 shadow-neon"},cn={class:"space-y-2"},ln={class:"text-white/40 uppercase tracking-widest text-[10px] font-medium leading-relaxed"},dn={class:"font-black text-primary px-1"},un={class:"grid grid-cols-2 gap-4"},pn={key:1,class:"glass-dark p-8 border border-primary/20 shadow-glass-dark rounded-[2.5rem] animate-zoom-in space-y-6"},gn={class:"flex items-center gap-4"},hn={class:"w-12 h-12 rounded-2xl bg-primary/10 flex items-center justify-center border border-primary/20"},yn={class:"space-y-1"},fn={class:"text-white/40 uppercase tracking-widest text-[10px] font-medium"},mn={class:"space-y-4"},vn={class:"flex items-start justify-between"},bn={class:"space-y-2"},wn={class:"flex items-center gap-2"},xn={class:"text-lg font-black text-white"},kn={key:0,class:"px-2 py-0.5 bg-primary/10 text-primary border border-primary/20 rounded-full text-[9px] font-black uppercase tracking-wider"},Sn={class:"text-xs text-white/40 font-mono"},Cn={key:0,class:"flex items-center justify-end gap-2 px-1 pb-2"},In=["onClick","aria-checked"],En={class:"grid grid-cols-2 gap-3"},An=["onClick"],_n=["onClick"],Nn={key:2,class:"glass-dark p-10 text-center space-y-8 border border-white/5 shadow-glass-dark rounded-[3rem] animate-zoom-in"},Pn={class:"space-y-4"},Tn={class:"inline-flex items-center gap-2 px-4 py-1.5 bg-primary/10 text-primary border border-primary/20 rounded-full text-[10px] font-black uppercase tracking-[0.2em] shadow-neon transform -translate-y-2"},Rn={class:"text-4xl font-black text-white uppercase tracking-tighter"},Gn={class:"text-xs text-white/30 uppercase font-black tracking-widest leading-relaxed max-w-lg mx-auto"},Ln={key:0,class:"flex flex-col items-center gap-6"},On={class:"space-y-4"},Kn={class:"mx-auto h-16 w-16 bg-rose-500/10 rounded-2xl flex items-center justify-center border border-rose-500/20"},$n={class:"grid grid-cols-2 gap-4 pt-6"},Dn={key:1,class:"flex flex-col items-center gap-8 py-6"},Mn={key:0,class:"relative"},Fn={class:"space-y-3"},Bn={class:"text-xl font-black text-white uppercase tracking-tight"},jn={class:"text-[10px] text-white/30 uppercase tracking-[0.2em] max-w-xs mx-auto font-medium leading-relaxed"},Jn={class:"space-y-4"},Un={class:"mx-auto h-16 w-16 bg-rose-500/10 rounded-2xl flex items-center justify-center border border-rose-500/20"},Hn={class:"grid grid-cols-2 gap-4 pt-6"},Vn={key:2,class:"pt-8 border-t border-white/5 space-y-6"},Yn={key:0,class:"glass-dark p-8 rounded-[2rem] border border-white/10 shadow-glass-dark space-y-6 group hover:border-primary/30 transition-all duration-500"},zn={class:"flex items-center justify-between"},Wn={class:"flex items-center gap-3"},Qn={class:"p-2.5 bg-primary/10 rounded-xl border border-primary/20"},Xn={class:"relative flex items-center gap-3"},Zn={class:"flex-grow bg-black/40 border border-white/10 rounded-xl px-4 py-3.5 font-mono text-[11px] text-white/60 truncate transition-all group-hover:bg-black/60 group-hover:border-white/20"},qn={key:"check",class:"flex items-center gap-2 animate-bounce-short"},es={key:"copy",class:"flex items-center gap-2"},ts={key:1,class:"space-y-4 text-left"},ns={class:"grid grid-cols-1 gap-6"},ss={key:3,class:"pt-8 border-t border-white/5 text-left"},as={key:3,class:"py-24 flex flex-col items-center justify-center space-y-6 border border-white/5 bg-white/5 rounded-[3rem] backdrop-blur-sm animate-fade-in"},is=ie({__name:"PreparationPhase",props:{state:{},isInitiator:{type:Boolean},signalingMode:{},isServerConnecting:{type:Boolean},signalingClient:{},pendingSignaling:{},pendingJoinRequests:{},isKnownIdentity:{type:Function},onStartGame:{type:Function},onHostAGame:{type:Function},onUpdateOffer:{type:Function},onUpdateAnswer:{type:Function},onCloseSession:{type:Function},onBackToLobby:{type:Function},onAcceptGuest:{type:Function},onRejectGuest:{type:Function},onApprovePeer:{type:Function},onRejectPeer:{type:Function},onSaveIdentity:{type:Function},onCancelSignaling:{type:Function},onRemovePlayer:{type:Function},playerCount:{},maxPlayers:{},boardId:{},gameId:{}},setup(e){const t=e,n=$({}),r=$({}),a=async b=>{t.isKnownIdentity&&(n.value[b]=await t.isKnownIdentity(b))},m=b=>b.length<=20?b:`${b.substring(0,10)}...${b.substring(b.length-10)}`,x=$(!1),y=C(()=>`${window.location.origin}${window.location.pathname}#/games/${t.gameId}/${t.boardId}`),w=async()=>{try{await navigator.clipboard.writeText(y.value),x.value=!0,setTimeout(()=>{x.value=!1},2e3)}catch(b){console.error("Failed to copy link:",b)}};Q(()=>t.pendingJoinRequests,b=>{b&&b.forEach(p=>{p.publicKey in n.value||a(p.publicKey)})},{deep:!0,immediate:!0});const d=async b=>{r.value[b.connectionId]&&t.onSaveIdentity&&await t.onSaveIdentity(b),t.onApprovePeer&&t.onApprovePeer(b),delete r.value[b.connectionId]},P=C(()=>t.state.matches("preparation")),j=C(()=>t.state.matches("hosting")),A=C(()=>t.state.matches("joining")),E=C(()=>t.state.matches("approving"));return(b,p)=>(g(),h("div",nn,[E.value&&e.state.context.pendingGuest?(g(),h("div",sn,[s("div",an,[s("div",on,[s("div",rn,[f(l(Se),{class:"w-10 h-10 text-primary animate-pulse"})]),s("div",cn,[p[6]||(p[6]=s("h2",{class:"text-2xl font-black text-white uppercase tracking-tight"},"Handshake Request",-1)),s("p",ln,[p[4]||(p[4]=R(" Entity ",-1)),s("span",dn,G(e.state.context.pendingGuest.name),1),p[5]||(p[5]=R(" attempts to bridge into session. ",-1))])])]),s("div",un,[s("button",{onClick:p[0]||(p[0]=(...k)=>e.onRejectGuest&&e.onRejectGuest(...k)),class:"h-14 rounded-2xl border border-white/10 text-white/60 hover:text-rose-500 hover:bg-rose-500/10 hover:border-rose-500/30 font-black uppercase tracking-widest text-xs transition-all"}," De-authorize "),s("button",{onClick:p[1]||(p[1]=(...k)=>e.onAcceptGuest&&e.onAcceptGuest(...k)),class:"h-14 rounded-2xl bg-primary text-primary-foreground shadow-neon hover:shadow-[0_0_30px_rgba(16,185,129,0.4)] font-black uppercase tracking-widest text-xs transition-all"}," Grant Access ")])])])):I("",!0),e.isInitiator&&e.pendingJoinRequests&&e.pendingJoinRequests.length>0?(g(),h("div",pn,[s("div",gn,[s("div",hn,[f(l(Se),{class:"w-6 h-6 text-primary"})]),s("div",yn,[p[7]||(p[7]=s("h2",{class:"text-2xl font-black text-white uppercase tracking-tight"},"Join Requests",-1)),s("p",fn,G(e.pendingJoinRequests.length)+" "+G(e.pendingJoinRequests.length===1?"peer":"peers")+" waiting for approval ",1)])]),s("div",mn,[(g(!0),h(q,null,De(e.pendingJoinRequests,k=>(g(),h("div",{key:k.connectionId,class:"glass-darker p-6 rounded-2xl border border-white/5 space-y-4"},[s("div",vn,[s("div",bn,[s("div",wn,[s("span",xn,G(k.peerName),1),n.value[k.publicKey]?(g(),h("span",kn," Known Identity ")):I("",!0)]),s("p",Sn,G(m(k.publicKey)),1)])]),n.value[k.publicKey]?I("",!0):(g(),h("div",Cn,[p[8]||(p[8]=s("span",{class:"text-xs text-white/50 uppercase tracking-wider font-medium"},"Auto-approve next time",-1)),s("button",{onClick:z=>r.value[k.connectionId]=!r.value[k.connectionId],class:de(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-gray-900",r.value[k.connectionId]?"bg-primary":"bg-white/10"]),role:"switch","aria-checked":r.value[k.connectionId]},[s("span",{class:de(["inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200",r.value[k.connectionId]?"translate-x-6":"translate-x-1"])},null,2)],10,In)])),s("div",En,[s("button",{onClick:z=>e.onRejectPeer&&e.onRejectPeer(k),class:"h-12 rounded-xl border border-white/10 text-white/60 hover:text-rose-500 hover:bg-rose-500/10 hover:border-rose-500/30 font-black uppercase tracking-widest text-xs transition-all"}," Reject ",8,An),s("button",{onClick:z=>d(k),class:"h-12 rounded-xl bg-primary text-primary-foreground shadow-neon hover:shadow-[0_0_30px_rgba(16,185,129,0.4)] font-black uppercase tracking-widest text-xs transition-all"}," Approve ",8,_n)])]))),128))])])):I("",!0),j.value||A.value||P.value||E.value?(g(),h("div",Nn,[s("div",Pn,[s("div",Tn,G(j.value||E.value?"Broadcasting Session":A.value?"Initializing Node":"Command Lobby Active"),1),s("h2",Rn,G(P.value?"Game Room":j.value?"Link Establishment":"Connecting..."),1),s("p",Gn,[P.value?(g(),h(q,{key:0},[R(G(e.isInitiator?`Authorize peer nodes or launch protocol when ready (${e.playerCount}/${e.maxPlayers}).`:"Waiting for initiator to launch protocol."),1)],64)):(g(),h(q,{key:1},[R("Synthesizing direct P2P mesh link to session nodes.")],64))])]),e.isInitiator?(g(),h("div",Ln,[P.value?(g(),h("button",{key:0,onClick:p[2]||(p[2]=(...k)=>e.onStartGame&&e.onStartGame(...k)),class:"w-full max-w-sm h-16 text-sm font-black uppercase tracking-[0.5em] rounded-2xl bg-primary text-primary-foreground shadow-[0_0_30px_rgba(16,185,129,0.3)] hover:shadow-[0_0_50px_rgba(16,185,129,0.5)] transition-all active:scale-[0.98]"}," Launch Protocol ")):I("",!0),f(l(Ze),null,{default:O(()=>[f(l(Ue),{asChild:""},{default:O(()=>[...p[9]||(p[9]=[s("button",{class:"px-4 h-12 rounded-xl text-white/20 hover:text-rose-500 font-black uppercase tracking-widest text-[10px] transition-colors"}," Terminate Session ",-1)])]),_:1}),f(l(He),null,{default:O(()=>[f(l(Ve),{class:"bg-black/80 fixed inset-0 z-[100] backdrop-blur-sm"}),f(l(Ye),{class:"glass-dark border border-white/10 rounded-[2rem] p-8 max-w-sm fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[101]"},{default:O(()=>[s("div",On,[s("div",Kn,[f(l(Je),{class:"w-8 h-8 text-rose-500"})]),f(l(ze),{class:"text-xl font-black text-center text-white uppercase tracking-tight"},{default:O(()=>[...p[10]||(p[10]=[R(" Terminate Session? ",-1)])]),_:1}),f(l(We),{class:"text-center text-white/40 text-xs font-medium uppercase tracking-widest leading-relaxed"},{default:O(()=>[...p[11]||(p[11]=[R(" Reloading or leaving will cause the game session to be lost. Peers will be disconnected and discovery mesh link terminated. ",-1)])]),_:1})]),s("div",$n,[f(l(Qe),{class:"h-12 rounded-xl bg-white/5 border border-white/5 text-white/60 hover:bg-white/10 font-bold uppercase tracking-widest text-[10px]"},{default:O(()=>[...p[12]||(p[12]=[R(" Abort ",-1)])]),_:1}),f(l(Xe),{onClick:e.onCloseSession,class:"h-12 rounded-xl bg-rose-500 text-white font-black uppercase tracking-widest text-[10px] hover:bg-rose-600 shadow-neon-sm"},{default:O(()=>[...p[13]||(p[13]=[R(" Confirm ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1})])):(g(),h("div",Dn,[P.value?I("",!0):(g(),h("div",Mn,[...p[14]||(p[14]=[s("div",{class:"animate-spin rounded-full h-20 w-20 border-4 border-primary/5 border-t-primary shadow-neon"},null,-1),s("div",{class:"absolute inset-0 flex items-center justify-center"},[s("div",{class:"h-3 w-3 bg-primary rounded-full animate-pulse shadow-neon"})],-1)])])),s("div",Fn,[s("h3",Bn,G(P.value?"Node Synced":"Bridging Connections"),1),s("p",jn,G(P.value?"Identity verified. Awaiting initiator's launch command.":"Establishing secure encrypted tunnel to host node."),1)]),f(l(Ze),null,{default:O(()=>[f(l(Ue),{asChild:""},{default:O(()=>[...p[15]||(p[15]=[s("button",{class:"h-10 text-white/20 hover:text-rose-500 font-black uppercase tracking-widest text-[10px] transition-colors"}," Sever Connection ",-1)])]),_:1}),f(l(He),null,{default:O(()=>[f(l(Ve),{class:"bg-black/80 fixed inset-0 z-[100] backdrop-blur-sm"}),f(l(Ye),{class:"glass-dark border border-white/10 rounded-[2rem] p-8 max-w-sm fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[101]"},{default:O(()=>[s("div",Jn,[s("div",Un,[f(l(Je),{class:"w-8 h-8 text-rose-500"})]),f(l(ze),{class:"text-xl font-black text-center text-white uppercase tracking-tight"},{default:O(()=>[...p[16]||(p[16]=[R(" Sever Connection? ",-1)])]),_:1}),f(l(We),{class:"text-center text-white/40 text-xs font-medium uppercase tracking-widest leading-relaxed"},{default:O(()=>[...p[17]||(p[17]=[R(" Leaving or reloading will sever your node link. The game session progress will be lost. ",-1)])]),_:1})]),s("div",Hn,[f(l(Qe),{class:"h-12 rounded-xl bg-white/5 border border-white/5 text-white/60 hover:bg-white/10 font-bold uppercase tracking-widest text-[10px]"},{default:O(()=>[...p[18]||(p[18]=[R(" Abort ",-1)])]),_:1}),f(l(Xe),{onClick:e.onBackToLobby,class:"h-12 rounded-xl bg-rose-500 text-white font-black uppercase tracking-widest text-[10px] hover:bg-rose-600 shadow-neon-sm"},{default:O(()=>[...p[19]||(p[19]=[R(" Confirm ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1})])),e.isInitiator?(g(),h("div",Vn,[e.signalingMode==="server"?(g(),h("div",Yn,[s("div",zn,[s("div",Wn,[s("div",Qn,[f(l(St),{class:"w-5 h-5 text-primary"})]),p[20]||(p[20]=s("div",{class:"text-left"},[s("h3",{class:"text-sm font-black text-white uppercase tracking-wider"},"Share Session Link"),s("p",{class:"text-[10px] text-white/30 uppercase tracking-widest font-medium"},"Link this node to the discovery mesh")],-1))]),p[21]||(p[21]=s("div",{class:"flex items-center gap-2 px-3 py-1 bg-primary/5 border border-primary/20 rounded-full"},[s("div",{class:"w-1.5 h-1.5 bg-primary rounded-full animate-pulse shadow-neon"}),s("span",{class:"text-[9px] font-black text-primary uppercase tracking-widest"},"Live Broadcast")],-1))]),s("div",Xn,[s("div",Zn,G(y.value),1),s("button",{onClick:w,class:"shrink-0 h-12 px-6 rounded-xl bg-primary text-primary-foreground font-black uppercase tracking-widest text-[10px] shadow-neon hover:shadow-[0_0_25px_rgba(16,185,129,0.4)] transition-all active:scale-95 flex items-center gap-2"},[f(bt,{mode:"out-in",name:"fade"},{default:O(()=>[x.value?(g(),h("div",qn,[f(l(xt),{class:"w-4 h-4"}),p[22]||(p[22]=R(" COPIED ",-1))])):(g(),h("div",es,[f(l(kt),{class:"w-4 h-4"}),p[23]||(p[23]=R(" COPY LINK ",-1))]))]),_:1})])])])):I("",!0),e.signalingMode==="manual"&&e.pendingSignaling.length>0?(g(),h("div",ts,[p[24]||(p[24]=s("h3",{class:"text-[11px] font-black text-white/20 uppercase tracking-[0.3em] px-1"},"Pending Link Authentications",-1)),s("div",ns,[(g(!0),h(q,null,De(e.pendingSignaling,k=>(g(),X(it,{key:k.id,connection:k,onOfferChange:e.onUpdateOffer,onAnswerChange:e.onUpdateAnswer,onCancel:e.onCancelSignaling},null,8,["connection","onOfferChange","onAnswerChange","onCancel"]))),128))])])):I("",!0)])):I("",!0),!e.isInitiator&&A.value&&e.signalingMode==="manual"&&e.pendingSignaling.length>0?(g(),h("div",ss,[f(it,{connection:e.pendingSignaling[0],onOfferChange:e.onUpdateOffer,onAnswerChange:e.onUpdateAnswer,onCancel:e.onCancelSignaling},null,8,["connection","onOfferChange","onAnswerChange","onCancel"])])):I("",!0)])):I("",!0),!j.value&&!A.value&&!P.value&&!E.value?(g(),h("div",as,[p[25]||(p[25]=wt('<div class="relative"><div class="h-20 w-20 bg-white/5 rounded-full flex items-center justify-center transition-transform hover:scale-110 duration-500"><div class="h-4 w-4 bg-white/10 rounded-full animate-ping"></div></div></div><div class="text-center space-y-2"><div class="text-xs font-black uppercase tracking-[0.5em] text-white/30">Null Reference: No Active Session</div><p class="text-[10px] text-white/20 uppercase tracking-widest px-10 leading-relaxed font-medium">Session data not found on current node. Return to discovery mesh.</p></div>',2)),s("button",{onClick:p[3]||(p[3]=(...k)=>e.onBackToLobby&&e.onBackToLobby(...k)),class:"h-12 px-8 rounded-xl border border-white/10 text-white/70 hover:text-primary hover:border-primary/40 font-black uppercase tracking-widest text-[10px] transition-all"}," Return to Discovery ")])):I("",!0)]))}}),os={class:"animate-zoom-in"},rs=ie({__name:"ActivePhase",props:{GameComponent:{},connectedPeers:{},playerInfos:{},isInitiator:{type:Boolean},ledger:{},onAddLedger:{type:Function},onFinishGame:{type:Function}},setup(e){const t=e,n=C(()=>({connections:t.connectedPeers,playerNames:t.playerInfos.map(r=>r.name),playerInfos:t.playerInfos,isInitiator:t.isInitiator,ledger:t.ledger,onAddLedger:t.onAddLedger,onFinishGame:t.onFinishGame}));return(r,a)=>(g(),h("div",os,[f(dt,{component:e.GameComponent,componentProps:n.value},null,8,["component","componentProps"])]))}}),cs={class:"space-y-6"},ls={class:"opacity-80 pointer-events-none grayscale-[0.2]"},ds={class:"glass-dark p-8 border border-white/5 shadow-glass-dark rounded-[2.5rem] animate-fade-in-up"},us={class:"flex flex-col md:flex-row items-center justify-between gap-6"},ps={class:"flex items-center gap-4"},gs={class:"h-14 w-14 bg-primary/10 rounded-2xl flex items-center justify-center border border-primary/20 shadow-neon"},hs={class:"flex gap-4 w-full md:w-auto"},ys=ie({__name:"FinishedPhase",props:{GameComponent:{},connectedPeers:{},playerInfos:{},isInitiator:{type:Boolean},ledger:{},onBackToLobby:{type:Function}},setup(e){const t=e,n=C(()=>({connections:t.connectedPeers,playerNames:t.playerInfos.map(r=>r.name),playerInfos:t.playerInfos,isInitiator:t.isInitiator,ledger:t.ledger,onAddLedger:()=>{},onFinishGame:()=>{}}));return(r,a)=>(g(),h("div",cs,[s("div",ls,[f(dt,{component:e.GameComponent,componentProps:n.value},null,8,["component","componentProps"])]),s("div",ds,[s("div",us,[s("div",ps,[s("div",gs,[f(l(ke),{class:"w-8 h-8 text-primary"})]),a[1]||(a[1]=s("div",{class:"space-y-1"},[s("h3",{class:"text-xl font-black text-white uppercase tracking-tight"},"Match Finalized"),s("p",{class:"text-[10px] text-white/30 uppercase tracking-widest font-black"},"All cycles complete. Handshake terminated.")],-1))]),s("div",hs,[s("button",{onClick:a[0]||(a[0]=(...m)=>e.onBackToLobby&&e.onBackToLobby(...m)),class:"w-full md:w-56 h-14 rounded-2xl bg-primary text-primary-foreground shadow-neon hover:shadow-[0_0_30px_rgba(16,185,129,0.4)] font-black uppercase tracking-[0.3em] text-xs transition-all"}," Return to Discovery ")])])]),a[2]||(a[2]=s("div",{class:"text-center text-white/10 text-[9px] font-black uppercase tracking-[0.4em] italic pt-4"}," Node state captured. Verification record locked inside vault. ",-1))]))}}),fs={class:"glass-dark p-8 rounded-[2rem] border border-white/5 shadow-glass-dark"},ms={class:"text-xs font-black uppercase tracking-[0.3em] text-white/40 mb-6 flex items-center gap-3"},vs={class:"space-y-4"},bs={class:"relative"},ws={key:0,class:"absolute inset-0 h-3 w-3 bg-primary rounded-full animate-ping opacity-50"},xs={class:"flex flex-col flex-1"},ks={class:"flex items-center gap-2"},Ss={class:"text-sm font-black text-white uppercase tracking-tight"},Cs={key:0,class:"text-primary font-black ml-1"},Is={key:0,class:"px-2 py-0.5 bg-primary/10 text-primary border border-primary/20 rounded-full text-[9px] font-black uppercase tracking-wider"},Es={key:0,class:"flex items-center gap-2 mt-2"},As=["onClick","aria-checked"],_s={class:"text-[9px] text-white/40 uppercase tracking-wider font-medium"},Ns={class:"text-[8px] text-white/30"},Ps={key:0,class:"ml-auto flex items-center gap-3"},Ts=["onClick"],Rs={key:0,class:"text-[10px] text-white/20 uppercase font-black tracking-[0.3em] text-center py-6 animate-pulse"},Gs=ie({__name:"Players",props:{players:{},onRemove:{type:Function},onSaveIdentity:{type:Function},isKnownIdentity:{type:Function}},setup(e){const t=e,n=$({}),r=$({}),a=async()=>{for(const y of t.players)y.publicKey&&!y.isLocal&&t.isKnownIdentity&&(n.value[y.id]=await t.isKnownIdentity(y.publicKey))},m=async y=>{const w=r.value[y.id],d=!w;console.log("[Players] Toggle save for:",y.name,"from",w,"to",d),d?await x(y):r.value[y.id]=!1},x=async y=>{if(console.log("[Players] Attempting to save identity for:",y.name,"publicKey:",y.publicKey,"isLocal:",y.isLocal),!y.publicKey){console.warn("[Players] Cannot save identity - no public key for:",y.name);return}if(!t.onSaveIdentity){console.warn("[Players] Cannot save identity - onSaveIdentity prop not provided");return}try{r.value[y.id]=!0,await t.onSaveIdentity(y),n.value[y.id]=!0,console.log("[Players] Successfully saved identity for:",y.name)}catch(w){console.error("[Players] Error saving identity:",w),r.value[y.id]=!1}};return Fe(()=>{a()}),Q(()=>t.players,()=>{a()},{deep:!0}),(y,w)=>(g(),h("div",fs,[s("h3",ms,[f(l(Se),{class:"w-5 h-5 text-primary"}),R(" Dwellers In Lobby ("+G(e.players.length)+") ",1)]),s("div",vs,[(g(!0),h(q,null,De(e.players,d=>(g(),h("div",{key:d.id,class:"flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/10 group hover:neon-border transition-all duration-500 animate-fade-in-left"},[s("div",bs,[s("div",{class:de(["h-3 w-3 rounded-full",d.isConnected?"bg-primary shadow-neon":"bg-rose-500 shadow-[0_0_15px_rgba(244,63,94,0.4)]"])},null,2),d.isConnected?(g(),h("div",ws)):I("",!0)]),s("div",xs,[s("div",ks,[s("span",Ss,[R(G(d.name)+" ",1),d.isLocal?(g(),h("span",Cs,"(LOCAL)")):I("",!0)]),!d.isLocal&&n.value[d.id]?(g(),h("span",Is," Known Identity ")):I("",!0)]),!d.isLocal&&d.isConnected&&!n.value[d.id]?(g(),h("div",Es,[s("button",{onClick:P=>m(d),class:de(["relative inline-flex h-5 w-9 items-center rounded-full transition-colors duration-200",r.value[d.id]?"bg-primary":"bg-white/10"]),role:"switch","aria-checked":r.value[d.id]},[s("span",{class:de(["inline-block h-3 w-3 transform rounded-full bg-white transition-transform duration-200",r.value[d.id]?"translate-x-5":"translate-x-1"])},null,2)],10,As),s("span",_s,G(r.value[d.id]?"Saved for auto-approve":"Auto-approve next time"),1),s("span",Ns,G(d.isLocal?"(Local)":"(Remote)")+" "+G(d.publicKey?"PK":"PK"),1)])):I("",!0)]),d.isConnected?I("",!0):(g(),h("div",Ps,[w[0]||(w[0]=s("span",{class:"text-[9px] text-rose-500 font-black uppercase tracking-widest"},"Node Disconnected",-1)),e.onRemove&&!d.isLocal?(g(),h("button",{key:0,class:"h-8 w-8 flex items-center justify-center text-rose-500 hover:text-rose-400 hover:bg-rose-500/10 transition-colors border border-transparent hover:border-rose-500/30 rounded-xl",onClick:P=>e.onRemove(d.id),title:"Sever entry"},[f(l(It),{class:"w-4 h-4"})],8,Ts)):I("",!0)]))]))),128)),e.players.length===0?(g(),h("p",Rs," Scanning for incoming nodes... ")):I("",!0)])]))}}),Ls={class:"min-h-screen bg-background"},Os={key:0,class:"max-w-7xl mx-auto p-6 space-y-12"},Ks={class:"text-3xl font-black tracking-tighter uppercase text-white"},$s={class:"text-gradient"},Ds={class:"animate-fade-in-up"},Ms={class:"mt-12 max-w-2xl"},Fs={key:1,class:"p-10 text-center text-white/50 uppercase font-black tracking-widest"},Bs="server",Zs=ie({__name:"BoardView",setup(e){const t=ot(),n=rt(),r=C(()=>t.params.gameId),a=C(()=>t.params.boardId),m=C(()=>lt(r.value||"")),x=()=>n.push("/games"),{snapshot:y,send:w,playerInfos:d,connectedPeers:P,pendingSignaling:j,pendingJoinRequests:A,isInitiator:E,isGameStarted:b,onHostAGame:p,isKnownIdentity:k,onApprovePeer:z,onRejectPeer:Y,saveIdentityOnApprove:Ce,updateOffer:Ie,updateAnswer:ne,startGame:pe,onFinishGame:ge,onAddLedger:Ee,onAcceptGuest:he,onRejectGuest:Ae,onCancelSignaling:_e,onBackToGames:Ne,signalingClient:ye,isServerConnecting:Pe}=Dt(),Te=async J=>{if(console.log("[BoardView] handleSavePlayerIdentity called for:",J.name,"publicKey:",J.publicKey),!J.publicKey){console.warn("[BoardView] Cannot save - no public key");return}const V={id:`identity-${Date.now()}`,name:J.name,publicKey:J.publicKey,addedAt:Date.now()};console.log("[BoardView] Saving identity to DB:",V),await ue.addKnownIdentity(V),console.log("[BoardView] Identity saved successfully"),xe.success("Identity Saved",{description:`${J.name} has been added to your known identities.`})},fe=C(()=>P.value),Re=()=>{Ne(),x()},me=C(()=>y.value?.matches("finished")||!1),Ge=C(()=>!b.value&&!me.value),ve=J=>{Ge.value&&(J.preventDefault(),J.returnValue="")};return Fe(async()=>{if(await ue.cleanupOldHostedSessions(),a.value&&y.value?.matches("idle"))if(await ue.isHosting(a.value)){const V=parseInt(t.query.maxPlayers)||2;console.log("[BOARDVIEW] Initializing HOST state for boardId:",a.value,"maxPlayers:",V),w({type:"HOST",maxPlayers:V,boardId:a.value})}else console.log("[BOARDVIEW] Initializing GUEST state for boardId:",a.value),w({type:"JOIN",boardId:a.value});window.addEventListener("beforeunload",ve)}),ct(()=>{window.removeEventListener("beforeunload",ve)}),(J,V)=>(g(),h("div",Ls,[m.value?(g(),h("div",Os,[s("h1",Ks,[V[0]||(V[0]=R(" Lobby: ",-1)),s("span",$s,G(m.value.name),1)]),s("div",Ds,[me.value?(g(),X(ys,{key:0,GameComponent:m.value.component,connectedPeers:fe.value,playerInfos:l(d),isInitiator:l(E),ledger:l(y)?.context?.ledger||[],onBackToLobby:x},null,8,["GameComponent","connectedPeers","playerInfos","isInitiator","ledger"])):l(b)?(g(),X(rs,{key:1,GameComponent:m.value.component,connectedPeers:fe.value,playerInfos:l(d),isInitiator:l(E),ledger:l(y)?.context?.ledger||[],onAddLedger:l(Ee),onFinishGame:l(ge)},null,8,["GameComponent","connectedPeers","playerInfos","isInitiator","ledger","onAddLedger","onFinishGame"])):(g(),X(is,{key:2,state:l(y),isInitiator:l(E),signalingMode:Bs,isServerConnecting:l(Pe),signalingClient:l(ye),pendingSignaling:l(j),pendingJoinRequests:l(A),isKnownIdentity:l(k),onStartGame:l(pe),onHostAGame:l(p),onUpdateOffer:l(Ie),onUpdateAnswer:l(ne),onCloseSession:Re,onBackToLobby:x,onAcceptGuest:l(he),onRejectGuest:l(Ae),onApprovePeer:l(z),onRejectPeer:l(Y),onSaveIdentity:l(Ce),onCancelSignaling:l(_e),onRemovePlayer:re=>l(w)({type:"REMOVE_PLAYER",playerId:re}),playerCount:l(d).length,maxPlayers:l(y)?.context?.maxPlayers||2,boardId:a.value,gameId:r.value},null,8,["state","isInitiator","isServerConnecting","signalingClient","pendingSignaling","pendingJoinRequests","isKnownIdentity","onStartGame","onHostAGame","onUpdateOffer","onUpdateAnswer","onAcceptGuest","onRejectGuest","onApprovePeer","onRejectPeer","onSaveIdentity","onCancelSignaling","onRemovePlayer","playerCount","maxPlayers","boardId","gameId"])),s("div",Ms,[f(Gs,{players:l(d),onRemove:l(E)?re=>l(w)({type:"REMOVE_PLAYER",playerId:re}):void 0,onSaveIdentity:Te,isKnownIdentity:l(k)},null,8,["players","onRemove","isKnownIdentity"])])])])):(g(),h("div",Fs," Game not found in grid. "))]))}});export{Zs as default};
