import{c as C,a as p,u as v,r as f,j as d,C as V,B,i as _,b as h}from"./index-BH42V_zP.js";const k=C({types:{},id:"ticTacToe",initial:"deciding",context:({input:e})=>({board:Array(9).fill(null),mySymbol:e.isInitiator?"X":"O",opponentSymbol:e.isInitiator?"O":"X",isInitiator:e.isInitiator,connections:[]}),states:{deciding:{always:[{target:"playing.myTurn",guard:({context:e})=>e.isInitiator},{target:"playing.opponentTurn"}]},playing:{initial:"decidingTurn",states:{decidingTurn:{always:[{target:"myTurn",guard:({context:e})=>{const r=e.board.filter(Boolean).length%2===0;return r&&e.mySymbol==="X"||!r&&e.mySymbol==="O"}},{target:"opponentTurn"}]},myTurn:{on:{MOVE:{target:"decidingTurn",guard:({context:e,event:t})=>!e.board[t.index],actions:["makeMyMove","broadcastMove"]}}},opponentTurn:{on:{RECEIVE_MOVE:{target:"decidingTurn",actions:"makeOpponentMove"}}}},always:[{target:"won",guard:"checkWinner"},{target:"draw",guard:"checkDraw"}]},won:{on:{RESET:{target:"deciding",actions:["resetBoard","broadcastReset"]},RECEIVE_RESET:{target:"deciding",actions:"resetBoard"}}},draw:{on:{RESET:{target:"deciding",actions:["resetBoard","broadcastReset"]},RECEIVE_RESET:{target:"deciding",actions:"resetBoard"}}}},on:{UPDATE_CONNECTIONS:{actions:"updateConnections"},SYNC_STATE:{target:".playing.decidingTurn",actions:"syncBoard"}}},{actions:{updateConnections:p(({event:e})=>e.type!=="UPDATE_CONNECTIONS"?{}:{connections:e.connections}),makeMyMove:p(({context:e,event:t})=>{if(t.type!=="MOVE")return{};const r=[...e.board];return r[t.index]=e.mySymbol,{board:r}}),makeOpponentMove:p(({context:e,event:t})=>{if(t.type!=="RECEIVE_MOVE")return{};const r=[...e.board];return r[t.index]=e.opponentSymbol,{board:r}}),resetBoard:p({board:()=>Array(9).fill(null)}),syncBoard:p(({event:e})=>e.type!=="SYNC_STATE"?{}:{board:e.board}),broadcastMove:({context:e,event:t})=>{t.type==="MOVE"&&e.connections.forEach(r=>r.send(JSON.stringify({namespace:"game",type:"MOVE",payload:{index:t.index}})))},broadcastReset:({context:e})=>{e.connections.forEach(t=>t.send(JSON.stringify({namespace:"game",type:"RESET"})))}},guards:{checkWinner:({context:e})=>!!g(e.board),checkDraw:({context:e})=>!g(e.board)&&e.board.every(Boolean)}});function g(e){const t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let r=0;r<t.length;r++){const[o,l,c]=t[r];if(e[o]&&e[o]===e[l]&&e[o]===e[c])return e[o]}return null}function I({connections:e,playerNames:t,playerInfos:r,isInitiator:o,ledger:l,onAddLedger:c,onFinishGame:b}){const[s,E]=v(k,{input:{isInitiator:o}}),{board:T,mySymbol:S}=s.context;f.useEffect(()=>{E({type:"UPDATE_CONNECTIONS",connections:e})},[e,E]),f.useEffect(()=>{const a=n=>{try{const i=JSON.parse(n);if(!_(i))return;i.type==="MOVE_REQUEST"?o&&c?.({type:"MOVE",payload:{index:i.payload.index}}):i.type==="RESET_REQUEST"&&o&&c?.({type:"RESET",payload:{}})}catch{}};return e.forEach(n=>{n.addMessageListener(a)}),()=>{e.forEach(n=>{n.removeMessageListener(a)})}},[e,o,c]),f.useEffect(()=>{if(!l)return;const a=Array(9).fill(null);let n=0;l.forEach(y=>{if(y.action.type==="MOVE"){const R=n%2===0?"X":"O";a[y.action.payload.index]=R,n++}else y.action.type==="RESET"&&(a.fill(null),n=0)}),E({type:"SYNC_STATE",board:a});const i=g(a),N=!i&&a.every(y=>y!==null);(i||N)&&b?.()},[l,E,b]);const w=a=>{o?c?.({type:"MOVE",payload:{index:a}}):e.forEach(n=>{n.send(JSON.stringify(h("MOVE_REQUEST",{index:a})))})},x=()=>{o?c?.({type:"RESET",payload:{}}):e.forEach(a=>{a.send(JSON.stringify(h("RESET_REQUEST")))})},m=s.matches("playing.myTurn"),O=g(T),M=s.matches("won")?O===S?"You Won!":"Opponent Won!":s.matches("draw")?"Draw!":m?"Your Turn":"Opponent's Turn",u=o||t.length>1;return d.jsxs(V,{className:"p-6 flex flex-col items-center space-y-4 bg-white/50 backdrop-blur-sm border-2 border-primary/20 shadow-xl rounded-2xl",children:[d.jsx("div",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent",children:"Tic-Tac-Toe"}),d.jsx("div",{className:`text-lg font-medium ${m&&u?"text-green-600 animate-pulse":"text-gray-500"}`,children:M}),d.jsx("div",{className:"grid grid-cols-3 gap-3",children:T.map((a,n)=>d.jsx("button",{onClick:()=>w(n),disabled:!m||!!a||s.matches("won")||s.matches("draw")||!u,className:`w-20 h-20 text-3xl font-black rounded-xl transition-all duration-200 border-2 
              ${a==="X"?"text-blue-600 border-blue-200 bg-blue-50":a==="O"?"text-rose-600 border-rose-200 bg-rose-50":"hover:bg-primary/5 hover:border-primary/30 border-gray-100 bg-white"}
              ${!m||a||s.matches("won")||s.matches("draw")||!u?"opacity-50 cursor-not-allowed":""}
              flex items-center justify-center shadow-sm hover:shadow-md active:scale-95`,children:a},n))}),(s.matches("won")||s.matches("draw"))&&u&&!b&&d.jsx(B,{onClick:x,variant:"outline",className:"mt-4 hover:bg-primary hover:text-white transition-colors",children:"Play Again"})]})}export{I as default};
